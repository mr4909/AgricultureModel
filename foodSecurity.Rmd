---
title: "Bangladesh Food Diary"
author: "Mari Roberts"
date: "2/10/2020"
output: pdf_document
---

Caloric count? 500 peak makes sense?
Monga

Spreadsheet 
Randomly select 

```{r}
# set wd
mydirectory <- "/Users/mr4909/AgricultureModel/Datasets"
setwd(mydirectory)

# load necessary packages
requiredPackages = c('foreign', # read dta
                     'dplyr',
                     'haven',
                     'readr',
                     'tidyverse') # missing values using map
# only downloads packages if needed
for(p in requiredPackages){
  if(!require(p,character.only = TRUE)) install.packages(p)
  library(p,character.only = TRUE)
}

# read in each dta file
filenames <- list.files(path=mydirectory, pattern=".*dta")
for (i in 1:length(filenames)){
  assign(filenames[i], read_dta(paste("", filenames[i], sep=''))
  )}

# remove NAs from HH members
# hh_all <- HouseholdComposition_members_level_2.dta %>% filter(currentposition != "NA")

hh_all <- HouseholdComposition_members_level_2.dta %>% select(hh_ID,
                                                              member_1_ID,
                                                              hhm_occu_type,
                                                              hhm_occupation,
                                                              canStandOwn = hhm_health1,
                                                              canWalk5Km = hhm_health2,
                                                              canCarry20L = hhm_health3)

# factor variables
hh_all$hhm_occu_type <- as.factor(hh_all$hhm_occu_type)
hh_all$hhm_occupation <- as.factor(hh_all$hhm_occupation)
# hh_all$canStandOwn <- as.factor(hh_all$canStandOwn)
# hh_all$canWalk5Km <- as.factor(hh_all$canWalk5Km)
# hh_all$canCarry20L <- as.factor(hh_all$canCarry20L)
# str(hh_all)

get_mode <- function(x){
  return(names(sort(table(x), decreasing = T, na.last = T)[1:10]))
}

# top occupations
get_mode(hh_all$hhm_occupation)

# top occupation types
get_mode(hh_all$hhm_occu_type)
```

*Top occupations:*
Raising poultry  	farming = 443
Raising livestock  	farming = 372
Animal Breeder  	livestock = 223
Small trader (roadside stand or stall)  	trader = 112
Agricultural day labor  	wage = 97
Farming = 76
Student  	nonearning = 64
Service (private sector )  	salaried = 53
Small industry  	prod = 42
Veterinary/paravet doctor  	livestock = 30

*Top occupation types:*
"nonearning" = 945
"farming" = 299
"trader" = 166
"salaried" = 150
"wage" = 124

*Health Measures*

0 = No
1 = Yes
77 = Don't know

Combined 0 and 77 

```{r}
hh_count <- HouseholdComposition_level_1.dta %>% select(hh_ID, hh_members) 
# reporting differences between hh_members throughout the year, likely deaths and births?
hh_count <- hh_count %>% distinct(hh_ID, .keep_all = TRUE)

# combine 0 and 77 ("no" and "don't know")
hh_all <- hh_all %>% mutate(canCarry20La = ifelse(canCarry20L==77 | canCarry20L==0, 0, 1),
                                canWalk5Kma = ifelse(canWalk5Km==77 | canWalk5Km==0, 0, 1),
                                canStandOwna = ifelse(canStandOwn==77 | canStandOwn==0, 0, 1))

# count health measures per household
hh_subset <- hh_all %>% select(hh_ID, canCarry20La, canWalk5Kma, canStandOwna)
          carry <- hh_subset %>% group_by(hh_ID) %>% tally(canCarry20La)
          walk <- hh_subset %>% group_by(hh_ID) %>% tally(canWalk5Kma)
          stand <- hh_subset %>% group_by(hh_ID) %>% tally(canStandOwna)

# determine percentage of health measure per household
hh_cleaned <- merge(hh_count, carry, by = "hh_ID") 
hh_cleaned <- merge(hh_cleaned, walk, by = "hh_ID") 
hh_cleaned <- merge(hh_cleaned, stand, by = "hh_ID") 
hh_cleaned <- hh_cleaned %>% select(hh_ID,
                                    hh_members,
                                    canCarry20L = n.x,
                                    canWalk5Km = n.y,
                                    canStandOwn = n) %>% 
                             mutate(pctCanCarry20L = canCarry20L/hh_members,
                                    pctCanWalk5Km = canWalk5Km/hh_members,
                                    pctCanStandOwn = canStandOwn/hh_members)

# remove percentages above 100, differences in number of members
hh_final <- hh_cleaned %>% filter(pctCanCarry20L <= 1 &
                                  pctCanWalk5Km <= 1 &
                                  pctCanStandOwn <= 1)

hh_final
```

- connections change when thinking about health measures

```{r}
foodDiary <- `34.FoodDiary_food_level_2.dta` %>% select(hh_ID, food_grp_namec)
table(foodDiary$food_grp_namec)                                                   
```

                      cereals          dairy         drinks      fishlarge      fishsmall 
            80           3492            309            158           1182            959 
        fruits       leafyveg        meategg            oil otherfoodohome         pulses 
           488           1504           2279           1373            140           1648 
        spices     vegetables 
           234           3058 

```{r}
food_summary <- foodDiary %>% select(hh_ID, food_grp_namec)

food_max <- food_summary %>%
  group_by(hh_ID, food_grp_namec) %>%
  summarise(n = n()) 

food_max <- tbl_df(food_max) %>%
      group_by(hh_ID) %>% 
      filter(n==max(n))

head(food_max)
# unique(food_max$hh_ID) #420
```

```{r}
table(food_max$food_grp_namec)
```

Next see what was reported during good and bad shocks in Bangladesh.

Droughts
Weather patterns - precipitation - Alex
Google Earth Engine?
Actual vs percieved? Rainfall? What does this tell us about how to interpret perceptions in terms of extreme events vs baseline.
Political events?
Illnesses
School attendance
Do people eat more water-rich foods when they have little access to water?

To do by 3/26/2020:
Histograms of variables
What did people not want to report on - still working
Methodology papers



*Facilities*

Traveling time
Types of facilities frequently visited

```{r}
facilities <- `20. Facilities_level_1.dta` 

# temp <- facilities %>% sum(grepl('1 ', facilities))
# 
# healthcenter = length(grep("1 ", facilities$facilities))
# busstop = length(grep("2 ", facilities$facilities))
# mainroad = length(grep("3 ", facilities$facilities))
# trainstation = length(grep("4 ", facilities$facilities))
# localshop = length(grep("5 ", facilities$facilities))
# bazaar = length(grep("6 ", facilities$facilities))
# nearesttown = length(grep("7 ", facilities$facilities))
# college = length(grep("8 ", facilities$facilities))
# agriculturaloffice = length(grep("9 ", facilities$facilities))
# postoffice = length(grep("10 ", facilities$facilities))
# bank = length(grep("11 ", facilities$facilities))
# BRAC = length(grep("12 ", facilities$facilities))
# grameenbank = length(grep("13 ", facilities$facilities))
# ASA = length(grep("14 ", facilities$facilities))

facility_visited <- data.frame(matrix(ncol=2, nrow=14))
facility_types <- c("healthcenter", 
                    "busstop",
                    "mainroad",
                    "trainstation",
                    "localshop",
                    "bazaar",
                    "nearesttown",
                    "college",
                    "agriculturaloffice",
                    "postoffice",
                    "bank",
                    "BRAC",
                    "grameenbank",
                    "ASA")

facility_count <- c(163,51,124,29,129,157,70,83,33,63,22,30,21,0)
facility_visited$X1 <- facility_types
facility_visited$X2 <- facility_count
facility_visited <- facility_visited %>% arrange(desc(X2))
facility_visited
```

*Housing*

Dec 2015 - Nov 2016

```{r}
housing_all <- `41. HousingandSanitation.dta` %>% select(hh_ID,
                                                         cellphone,
                                                         house_old, 
                                                         house_sharing, 
                                                         housewall_material, 
                                                         housewall_material_other, 
                                                         houseroof_material, 
                                                         houseroof_material_other, 
                                                         housefloor_material, 
                                                         housefloor_material_other, 
                                                         house_rooms, 
                                                         house_rooms_sleeping, 
                                                         house_elec, 
                                                         house_supply_off, 
                                                         fuel_source, 
                                                         fuel_source_other, 
                                                         lighting_source, 
                                                         latrine_type, 
                                                         latrine_other, 
                                                         water_supply, 
                                                         water_other_purpose, 
                                                         water_other, 
                                                         drinking_source_same, 
                                                         drinking_source, 
                                                         drinking_other, 
                                                         water_purify, 
                                                         water_purify_other, 
                                                         handpump, 
                                                         garbage, 
                                                         garbage_other)
# map(housing_all, ~sum(is.na(.)))
```

A third of participants didn't respond about how often the electricity shuts off. Other than that, there aren't many missing values in housing characteristics.

# Missing Data

##Agricultural Data

01. AgriculturalExtensionServices.dta
02. AgriculturalProduction_level_1.dta
03. AgriculturalProduction_plot_repeat_begin_level_2.dta
04. AgriculturalProduction_crop_level_3.dta
06. AgriculturalSubsidyCard.dta

Missing Values
```{r}
map(`01.AgriculturalExtensionServices.dta`, ~sum(is.na(.)))
```


###07. BadShocks_level_1.dta
###08. BadShocks_event_repeat_level_2.dta

###09. ClimateEvent.dta

###10. Cosmetics_level_1.dta
###11. Cosmetics_item_repeat_level_2.dta

###12. Crops_level_1.dta
###13. Crops_plot_repeat_begin_level_2.dta
###14. Crops_crop_level_3.dta
###15. Crops_group_crop_i_croptype_level_4.dta

###16. CurrentMigrants_level_1.dta
###17. CurrentMigrants_begin_repeat_mig_level_2.dta

###18. DrinkingWater_level_1.dta
###19. DrinkingWater_source_level_2.dta

###20. Facilities_level_1.dta
###21. Facilities_facility_repeat_level_2.dta

###22. FertilizersAndPesticides_level_1.dta
###23. FertilizersAndPesticides_plot_repeat_begin_level_2.dta
###24. FertilizersAndPesticides_crop_level_3.dta
###25. FertilizersAndPesticides_group_crop_i_croptype_level_4.dta
###26. FertilizersAndPesticides_rep_fert_level_5.dta

###27. FishPondInputs_level_1.dta
###28. FishPondInputs_begin_level_2.dta
###29. FishPondProduction_level_1.dta
###30. FishPondProduction_pond_begin_repeat_level_2.1.dta
###31. FishPondProduction_river_repeat_level_2.2.dta
###32. FishPondProduction_fish_repeat_level_3.dta

###33. FoodDiary_level_1.dta
###34. FoodDiary_food_level_2.dta
###35. Fooddiary_food_foodtype_level_3.dta
###36. FoodStorageCapacity.dta

###37. FuelLighting_level_1.dta
###38. FuelLighting_item_repeat_level_2.dta

###39. GoodShocks_level_1.dta
###40. GoodShocks_event_repeat_level_2.dta

###41. HousingandSanitation.dta

###42. InformationTools_level_1.dta
###43. InformationTools_tech_level_2.dta
###44. InformationTools_tech_use_level_3.dta

###45. Irrigation_level_1.dta
###46. Irrigation_plot_repeat_begin_level_2.dta
###47. Irrigation_crop_level_3.dta
###48. Irrigation_group_crop_i_crop_repeat_type_level_4.dta

###49. Livestock_level_1.dta
###50. Livestock_animal_level_2.dta

###51. Loans_level_1.dta
###52. Loans_each_loan_level_2.dta

###53. Marketing_level_1.dta
###54. Marketing_sellrell_prod_repeat_level_2.dta

###55. MobileInternet_level_1.dta
###56. MobileInternet_app_use_level_2.dta

###57. NonAgriculturalEnterprise_level_1.dta
###58. NonAgriculturalEnterprise_buss_level_2.dta

###59. OtherIncome_level_1.dta

###60. OtherIncome_income_level_2.dta

###61. RemittanceIn_level_1.dta
###62. RemittanceIn_begin_repeat_mig_level_2.dta
###63. RemittanceOut_level_1.dta
###64. RemittanceOut_begin_repeat_mig_level_2.dta

###65. SafetyProgram_level_1.dta
###66. SafetyProgram_event_repeat_level_2.dta

###67. Savings_level_1.dta
###68. Savings_each_savings_level_2.dta

###69. SubjectiveWellbeing.dta

###70. TransportTravel_level_1.dta
###71. TransportTravel_item_repeat_level_2.dta
###72. TransportationTools_level_1.dta
###73. TransportationTools_transport_level_2.dta
###74. TransportationTools_transport_use_level_3.dta

###75. WashingCleaning_level_1.dta
###76. WashingCleaning_item_repeat_level_2.dta

###77. WorkAnimals_level_1.dta
###78. WorkAnimals_animals_level_2.dta
###79. WorkAnimals_animals_use_level_3.dta

###80. employment_level_1.dta
###81. employment_work_done_level_2.dta

###82. farmLabor_level_1.dta
###83. farmLabor_begin_repeat_plot_level_2.dta
###84. farmLabor_labor_repeat_level_3.dta

###85. illness_level_1.dta
###86. illness_was_ill_level_2.dta

###87. latrineUse.dta
###88. latrineWalk_level_1.dta
###89. latrineWalk_begin_repeat_lat_level_2.dta

###90. rentingToolsMachAn_level_1.dta
###91. rentingToolsMachAn_plot_repeat_begin_level_2.dta
###92. rentingToolsMachAn_crop_level_3.dta
###93. rentingToolsMachAn_group_crop_i_crop_repeat_type_level_4.dta

###94. schoolAttendance_level_1.dta
###95. schoolAttendance_missed_school_level_2.dta

###96. tubewellWalk_level_1.dta
###97. tubewellWalk_begin_repeat_tw_level_2.dta

```{r}
map(`01.AgriculturalExtensionServices.dta`, ~sum(is.na(.)))
```

