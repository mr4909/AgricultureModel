---
title: "Economic Well-Being in Bagladesh"
author: "Mari Roberts"
date: "4/7/2020"
output: pdf_document
---

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# load necessary packages
requiredPackages = c('foreign', # read dta
                     'dplyr',
                     'haven',
                     'gridExtra',
                     'readr',
                     'dummies',
                     'data.table',
                     'FactoMineR',
                     'factoextra',
                     'ggplot2', # plots
                     'tidyverse') # missing values using map
# only downloads packages if needed
for(p in requiredPackages){
  if(!require(p,character.only = TRUE)) install.packages(p)
  library(p,character.only = TRUE)
}

# set wd
mydirectory <- "/Users/mari/AgricultureModel/Datasets"
setwd(mydirectory)

filenames <- list.files(path=mydirectory, pattern=".*dta")

# read in each dta file
filenames <- list.files(path=mydirectory, pattern=".*dta")
for (i in 1:length(filenames)){
  assign(filenames[i], read_dta(paste("", filenames[i], sep=''))
  )}
```

# Questions Asked Once

```{r include=FALSE}
####################################################
## Health and Demographics
####################################################

##########################
# Basic Info
##########################

# find number of hh members for calculations later
hh_count <- HouseholdComposition_level_1.dta %>% select(hh_ID, member_1_ID, hh_members) 
hh_count <- hh_count %>% distinct(hh_ID, .keep_all = TRUE)

# rename variables
hh_all <- HouseholdComposition_members_level_2.dta %>% mutate(height_meters = tot_height_inch*0.0254,
                                                              canStandOwn = hhm_health1,
                                                              canWalk5Km = hhm_health2,
                                                              canCarry20L = hhm_health3)

# BMI categories
hh_all <- hh_all %>% mutate(bmi = (weight_kg/(height_meters^2)))

# remove outliers for weight and height
hh_all <- hh_all %>% filter(tot_height_inch >= 1 & tot_height_inch <= 100)
hh_all <- hh_all %>% filter(weight_kg >= 1 & weight_kg <= 100)

# create BMI categories
hh_all <- hh_all %>% mutate(bmiCategory = ifelse(bmi >= 30, "obese", 
                                          ifelse(bmi >=25, "overweight", 
                                          ifelse(bmi >=18.5, "normal", 
                                          ifelse(bmi < 18.5, "underweight", NA)))))

# combine 0 and 77 ("no" and "don't know")
hh_all <- hh_all %>% mutate(canCarry20L = ifelse(canCarry20L==77 | canCarry20L==0, 0, 1),
                            canWalk5Km = ifelse(canWalk5Km==77 | canWalk5Km==0, 0, 1),
                            canStandOwn = ifelse(canStandOwn==77 | canStandOwn==0, 0, 1))

# 0 = male, 1 = female 
# select demographic variables
hh_all <- hh_all %>% mutate(sex = ifelse(hhm_sex == 1,0,1)) %>% 
                       select(hh_ID,
                              member_1_ID,
                              hhm_relation,
                              sex,
                              age = hhm_age,
                              maritalStatus = marital_status,
                              literacy,
                              education,
                              attendingCollege = hhm_attending,
                              occupationType = hhm_occu_type,
                              canCarry20L,
                              canWalk5Km,
                              canStandOwn,
                              bmi,
                              bmiCategory)

# change into factor variables
hh_all$sex = factor(hh_all$sex)
hh_all$maritalStatus = factor(hh_all$maritalStatus)
hh_all$literacy = factor(hh_all$literacy)
hh_all$education = factor(hh_all$education)
hh_all$occupationType = factor(hh_all$occupationType)
hh_all$bmiCategory = factor(hh_all$bmiCategory)

# does hh have children?
hh_all <- hh_all %>% mutate(isChild = ifelse(age>=18, 0, 1))
hh_children <- hh_all %>% group_by(hh_ID) %>% tally(isChild)
hh_children <- hh_children %>% mutate(numChildren = n) %>% select(hh_ID, numChildren)

# merge datasets
hh_all <- merge(hh_children, hh_all, by = "hh_ID")
  
##########################
# Data by resondents
##########################

# data about respondents
hh_respondent <- hh_all %>% filter(hhm_relation == 1)

##########################
# Health by Household
##########################

# count health measures per household
hh_subset <- hh_all %>% select(hh_ID, member_1_ID, bmi, canCarry20L, canWalk5Km, canStandOwn)
          carry <- hh_subset %>% group_by(hh_ID) %>% tally(canCarry20L)
          walk <- hh_subset %>% group_by(hh_ID) %>% tally(canWalk5Km)
          stand <- hh_subset %>% group_by(hh_ID) %>% tally(canStandOwn)

# determine percentage of health measure per household
hh_health <- merge(hh_count, carry, by = "hh_ID") 
hh_health <- merge(hh_health, walk, by = "hh_ID") 
hh_health <- merge(hh_health, stand, by = "hh_ID") 
hh_health <- hh_health %>% select(hh_ID,
                                    member_1_ID,
                                    hh_members,
                                    canCarry20L = n.x,
                                    canWalk5Km = n.y,
                                    canStandOwn = n) %>% 
                             mutate(pctCanCarry20L = canCarry20L/hh_members,
                                    pctCanWalk5Km = canWalk5Km/hh_members,
                                    pctCanStandOwn = canStandOwn/hh_members)

# remove percentages above 100, differences in number of members
hh_health <- hh_health %>% filter(pctCanCarry20L <= 1 &
                                  pctCanWalk5Km <= 1 &
                                  pctCanStandOwn <= 1) %>% select(-canCarry20L,-canWalk5Km,-canStandOwn)

hh_char <- merge(hh_health, hh_children, by = "hh_ID")
hh_char <- hh_char %>% select(-member_1_ID)

# TRUE, if there are no duplicates in hh_ID
# length(unique(hh_char$hh_ID)) == nrow(hh_char)

####################################################
## Housing Characteristics
####################################################

# housing and sanitation characteristics
housing_all <- `41. HousingandSanitation.dta` 

# 113148 120225 221250 224277 more than one entry
# probably need to figure out how to get rid of these. Max date?????????
# housing_all$hh_ID[duplicated(housing_all$hh_ID)]
# housing_all <- housing_all %>% filter(hh_ID != 113148 &
#                                       hh_ID != 120225 &
#                                       hh_ID != 221250 &
#                                       hh_ID != 224277)

##########
# if there is a hh_ID duplicate, use the first entry
# question was only supposed to be answered once but some households submitted twice
##########
# TRUE, if there are no duplicates in hh_ID
# length(unique(housing_all$hh_ID)) == nrow(housing_all)
housing_all$submissiondate <- as.Date(housing_all$submissiondate, "%b %d, %Y")
housing_all <- setDT(housing_all)[housing_all[, .I[which.min(submissiondate)], by=hh_ID]$V1]
housing_all <- housing_all %>% select(-submissiondate)
##########

# respondent input year instead of years old
# determine house age
housing_fix_year <- housing_all %>% arrange(desc(house_old))
housing_fix_year <- head(housing_fix_year, 19)
housing_fix_year <- housing_fix_year %>% select(hh_ID, house_old, today)
housing_fix_year$today <- as.Date(housing_fix_year$today, "%b %d, %Y")
housing_fix_year$submissionyear <- as.numeric(format(housing_fix_year$today,'%Y'))
housing_fix_year<- housing_fix_year %>% mutate(house_age = submissionyear-house_old) %>% select(hh_ID, house_age)
housing_all_not_fix_year <- housing_all %>% filter(hh_ID != 115161 &
                                        hh_ID != 120230 &
                                        hh_ID != 105055 &
                                        hh_ID != 221250 &
                                        hh_ID != 233386 &
                                        hh_ID != 120238 &
                                        hh_ID != 222252 &
                                        hh_ID != 240474 &
                                        hh_ID != 108087 &
                                        hh_ID != 120228 &
                                        hh_ID != 230349 &
                                        hh_ID != 235414 &
                                        hh_ID != 231368 &
                                        hh_ID != 115165 &
                                        hh_ID != 235407 &
                                        hh_ID != 229339 &
                                        hh_ID != 224284 &
                                        hh_ID != 232370) %>% select(hh_ID, house_old)
housing_all_not_fix_year <- housing_all_not_fix_year %>% mutate(house_age = house_old) %>% select(-house_old)
housing_all_years_fixed <- merge(housing_all_not_fix_year, housing_fix_year, by = c("hh_ID"), all=TRUE)
housing_all_years_fixed <- housing_all_years_fixed %>% select(hh_ID, house_age = house_age.x)

# select variables
housing_all <- housing_all %>% select(-sanitation_1_ID,-expiration_date,
                                      -max_submissions,-task_value,-task_length,-recall,
                                      -recall_length,-crowdsource,-week_number,-start_time,
                                      -end_time, -today, -start_date)

# merge datasets
housing_all <- merge(housing_all_years_fixed, housing_all, by = c("hh_ID"))

####################################################
## Latrine and Water
####################################################

# select variables
latrine_all <- `87. latrineUse.dta` %>% select(hh_ID, submissiondate, use_lat, main_use, count_latrine, pct_open)

##########
# if there is a hh_ID duplicate, use the first entry
##########
latrine_all$submissiondate <- as.Date(latrine_all$submissiondate, "%b %d, %Y")
latrine_all <- setDT(latrine_all)[latrine_all[, .I[which.min(submissiondate)], by=hh_ID]$V1]
latrine_all <- latrine_all %>% select(-submissiondate)
##########

# merge datasets
housing_all <- merge(latrine_all, housing_all, by = c("hh_ID"))
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]

####################################################
## Non-agricultural enterprise
####################################################

# Anyone in household owned/operated any business in 12 months?
nonagricultural_enterprise <- `57. NonAgriculturalEnterprise_level_1.dta` %>% select(hh_ID, submissiondate, business)

##########
# if there is a hh_ID duplicate, use the first entry
##########
nonagricultural_enterprise$submissiondate <- as.Date(nonagricultural_enterprise$submissiondate, "%b %d, %Y")
nonagricultural_enterprise <- setDT(nonagricultural_enterprise)[nonagricultural_enterprise[, .I[which.min(submissiondate)], by=hh_ID]$V1]
nonagricultural_enterprise <- nonagricultural_enterprise %>% select(-submissiondate)
##########

# merge with household characteristics
housing_all <- merge(nonagricultural_enterprise, housing_all, by = c("hh_ID"))
# housing_all$hh_ID[duplicated(housing_all$hh_ID)]
# str(housing_all)

#################
# ordered factor variables
#################

housing_all$pct_open <- factor(housing_all$pct_open, ordered = TRUE)
# What kind of toilet facility do members of your household use most of the time?
housing_all$main_use <- factor(housing_all$main_use, ordered = TRUE)
# house wall, roof, and floor
housing_all$housewall_material <- factor(housing_all$housewall_material, ordered = TRUE)
housing_all$houseroof_material <- factor(housing_all$houseroof_material, ordered = TRUE)
housing_all$housefloor_material <- factor(housing_all$housefloor_material, ordered = TRUE)

####################################################
## Facilities
####################################################

facilities <- `20. Facilities_level_1.dta` %>% select(hh_ID,submissiondate, facilities,fac_count)

# there are too many variations on the types of facilities visited, so change to:
# visits health centers, bazaar, local shops
facilities$visits_healthcenter <- ifelse(grepl("1",facilities$facilities), 1, 0)
facilities$visits_bazaar <- ifelse(grepl("6",facilities$facilities), 1, 0)
facilities$visits_localshop <- ifelse(grepl("5",facilities$facilities), 1, 0)
facilities <- facilities %>% select(-facilities)

##########
# if there is a hh_ID duplicate, use the first entry
##########
facilities$submissiondate <- as.Date(facilities$submissiondate, "%b %d, %Y")
facilities <- setDT(facilities)[facilities[, .I[which.min(submissiondate)], by=hh_ID]$V1]
facilities <- facilities %>% select(-submissiondate)
##########

# merge with household characteristics
housing_all <- merge(facilities, housing_all, by = c("hh_ID"))
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]

####################################################
## Farming Plots
####################################################

# merge plot datasets together
plots <- Plots_plot_level_2.dta # fix year
temp <- plots_level_1.dta %>% select(hh_ID, submissiondate, plot_1_ID, today) 
plots <- merge(plots, temp, by=c("hh_ID","plot_1_ID"))

# determine plot age
plots$today <- format(as.Date(plots$today, format="%b %d, %Y"),"%Y")
plots$yr_acq <- format(as.Date(plots$yr_acq, format="%b %d, %Y"),"%Y")  
plots$today <- as.numeric(plots$today)
plots$yr_acq <- as.numeric(plots$yr_acq)
plots$plot_age <- plots$today - plots$yr_acq 

# too many plot types (change to three types: homestead, cultivable, other)
plots$plot_type_homestead <- ifelse(grepl("1",plots$plot_type), 1, 0)
temp <- c("2","8")
plots$plot_type_cultivable_land_pond <- ifelse(grepl(paste(temp, collapse = "|"),plots$plot_type), 1, 0)
temp <- c("3","4","5","6","7","9"," ")
plots$plot_type_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$plot_type), 1, 0)

# who_owns - too many factor levels (change to three types)
plots$who_owns_male <- ifelse(grepl("1",plots$who_owns), 1, 0)
plots$who_owns_family <- ifelse(grepl("2",plots$who_owns), 1, 0)
temp <- c("3","4","5","6")
plots$who_owns_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_owns), 1, 0)

# who_owns_off - too many factor levels (change to three types)
plots$who_owns_off_male <- ifelse(grepl("1",plots$who_owns_off), 1, 0)
plots$who_owns_off_family <- ifelse(grepl("2",plots$who_owns_off), 1, 0)
temp <- c("3","4","5","6")
plots$who_owns_off_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_owns_off), 1, 0)
 
# who_decision - too many factor levels (change to three types)
plots$who_decision_male <- ifelse(grepl("1",plots$who_decision), 1, 0)
plots$who_decision_family <- ifelse(grepl("2",plots$who_decision), 1, 0)
temp <- c("3","4","5","6")
plots$who_decision_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_decision), 1, 0)

# who_responsible - not enough responses, didn't include

# who_dec_spd - too many factor levels (change to three types)
plots$who_dec_spd_male <- ifelse(grepl("1",plots$who_dec_spd), 1, 0)
plots$who_dec_spd_family <- ifelse(grepl("2",plots$who_dec_spd), 1, 0)
temp <- c("3","4","5","6")
plots$who_dec_spd_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_dec_spd), 1, 0)

# who_infra - too many factor levels (change to three types)
plots$who_infra_male <- ifelse(grepl("1",plots$who_infra), 1, 0)
plots$who_infra_family <- ifelse(grepl("2",plots$who_infra), 1, 0)
temp <- c("3","4","5","6")
plots$who_infra_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_infra), 1, 0)

##########
# if there is a hh_ID duplicate, use the first entry
##########
# 100+ duplicates
plots$hh_ID[duplicated(plots$hh_ID)]
plots$submissiondate <- as.Date(plots$submissiondate, "%b %d, %Y")
plots <- setDT(plots)[plots[, .I[which.min(submissiondate)], by=hh_ID]$V1]
plots <- plots %>% select(-submissiondate)
##########

# select final variables
plots <- plots %>%  select( hh_ID,
                            plot_type_homestead,
                            plot_type_cultivable_land_pond,
                            plot_type_other,
                            size_plot,
                            flood_depth, # wrong units probably
                            dis_from_home,
                            soil_type,
                            cur_opr_status,
                            amt_rec,
                            cur_mv,
                            how_acq,
                            plot_age,
                            plot_use,
                            work_last_seas,
                            # In last 12 months, who decided to build any infrastructure on this plot?
                            who_infra_male,
                            who_infra_family,
                            who_infra_other,
                            # Who uses the plot?  
                            who_owns_male,
                            who_owns_family,
                            who_owns_other,
                            # Who officially owns?
                            who_owns_off_male,
                            who_owns_off_family,
                            who_owns_off_other,
                            # who_decision who takes most decisions regarding type of crop to be planted or fish to be raised?
                            who_decision_male,
                            who_decision_family,
                            who_decision_other,
                            # who decides how to spend revenues generated from crops or fish?
                            who_dec_spd_male,
                            who_dec_spd_family,
                            who_dec_spd_other)

# merge with household characteristics
housing_all <- merge(plots, housing_all, by = c("hh_ID"))
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]

##################################################################
## Remove nested and NA questions
##################################################################

# remove variables with almost all missing values
housing_cleaned <- housing_all %>% select(-rent_paid, 
                                          -drinking_source, 
                                          -house_supply_off, 
                                          -house_elec_cost, 
                                          -fuel_source_other,
                                          -drinking_source, 
                                          -water_purify_other, 
                                          -arsenic_check, 
                                          #-water_purpose_other, 
                                          -color_check)

# remove variables with almost all missing values
housing_cleaned <- housing_cleaned %>% select(-work_last_seas, 
                                              #-who_responsible, 
                                              -housewall_material_other, 
                                              -houseroof_material_other, 
                                              -housefloor_material_other, 
                                              -lighting_source_other, 
                                              -latrine_other, 
                                              -water_other, 
                                              -drinking_other, 
                                              -garbage_other, 
                                              -amt_rec,
                                              -handpump)
# View missing values by variable
# map(housing_cleaned, ~sum(is.na(.)))

# merge datasets
hh_data <- merge(housing_cleaned, hh_char, by = "hh_ID")
#chh_data$hh_ID[duplicated(hh_data$hh_ID)]

#########################################################
# Separate categorical variables and continuous variables
#########################################################
categorical_variables <- hh_data %>% select(-size_plot, 
                                                    -flood_depth, 
                                                    -dis_from_home, 
                                                    -cur_mv, 
                                                    -plot_age, 
                                                    -count_latrine, 
                                                    -rent_estimate, 
                                                    -house_old,
                                                    -fuel_cost, 
                                                    -lighting_cost, 
                                                    -cell_cost, 
                                                    -cellphone,
                                                    -house_rooms, 
                                                    -house_rooms_sleeping,
                                                    -house_age, 
                                                    -fac_count,
                                                    -numChildren,
                                                    -pctCanCarry20L,
                                                    -pctCanWalk5Km,
                                                    -pctCanStandOwn,
                                                    -hh_members,
                                                    -count_latrine)
continuous_variables <- hh_data %>% select(hh_ID, size_plot, 
                                                    flood_depth, 
                                                    dis_from_home, 
                                                    cur_mv, 
                                                    plot_age, 
                                                    count_latrine, 
                                                    rent_estimate, 
                                                    fuel_cost, 
                                                    lighting_cost, 
                                                    cell_cost, 
                                                    cellphone,
                                                    house_rooms, 
                                                    house_rooms_sleeping,
                                                    house_age, 
                                                    fac_count,
                                                    numChildren,
                                                    pctCanCarry20L,
                                                    pctCanWalk5Km,
                                                    pctCanStandOwn,
                                                    hh_members,
                                                    count_latrine)

# scale continuous variables
continuous_variables1 <- apply(continuous_variables[,2:21], 2, scale)
continuous_variables <- data.frame(continuous_variables1,continuous_variables$hh_ID)
continuous_variables <- continuous_variables %>% mutate(hh_ID = continuous_variables.hh_ID) %>% select(-continuous_variables.hh_ID)

##################################
# factor variables that are characters
##################################

# convert variables to factor variables except hh_ID (column 1)
categorical_variables[,2:44] <- lapply(categorical_variables[,2:44], function(x) as.factor(as.character(x)))
#str(categorical_variables)
#str(continuous_variables)

# merge categorical and continous variables into one dataframe
final_hh_data <- merge(categorical_variables, continuous_variables, by ="hh_ID")
```

# PCA

final_hh_data is standardized and scaled

```{r}
# remove NAs
final_hh_data_noNAs <- final_hh_data[complete.cases(final_hh_data),]
# recode dummy frame
final_hh_data_noNAs <- dummy.data.frame(final_hh_data_noNAs)

# Calculate eigenvalues & eigenvectors
hh.cov <- cov(final_hh_data_noNAs)
hh.eigen <- eigen(hh.cov)
# str(hh.eigen)

# Compute PCA
res.pca <- prcomp(final_hh_data_noNAs, scale. = T)

# Visualize eigenvalues (scree plot). Show the percentage of variances explained by each principal component.
fviz_eig(res.pca)
```

Graph of individuals. Individuals with a similar profile are grouped together.

```{r}
fviz_pca_var(res.pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE     # Avoid text overlapping
             )

fviz_pca_ind(res.pca,
             col.ind = "cos2", # Color by the quality of representation
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE     # Avoid text overlapping
             )

fviz_pca_ind(res.pca, pointsize = "cos2", 
             pointshape = 21, fill = "#E7B800",
             repel = TRUE)

fviz_pca_ind(res.pca, col.ind = "cos2", pointsize = "cos2",
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE) 

# Total contribution on PC1 and PC2
# Contributions of variables to PC1
fviz_contrib(res.pca, choice = "var", axes = 1, top = 10)

# Contributions of variables to PC2
fviz_contrib(res.pca, choice = "var", axes = 2, top = 10)

# Contributions of variables to PC3
fviz_contrib(res.pca, choice = "var", axes = 3, top = 10)

# Contributions of variables to PC4
fviz_contrib(res.pca, choice = "var", axes = 4, top = 10)

# Contributions of variables to PC5
fviz_contrib(res.pca, choice = "var", axes = 5, top = 10)
```

# Figure out dimensions of well-being using Factor Analysis

http://www.di.fc.ul.pt/~jpn/r/factoranalysis/factoranalysis.html#factor-analysis-vs.pca

```{r}
library(psych)
library(nFactors)
pca_df <- final_hh_data_noNAs %>% select(-hh_ID)

ev <- eigen(cor(pca_df)) # get eigenvalues
ap <- parallel(subject=nrow(pca_df),var=ncol(pca_df), rep=100, cent=.05)
nS <- nScree(x=ev$values, aparallel=ap$eigen$qevpea)
plotnScree(nS)

factor26 <- fa(pca_df,nfactors = 26,rotate = "oblimin",fm="minres")
print(factor26)
```

The blue line shows eigenvalues of actual data and the two red lines (placed on top of each other) show simulated and resampled data. Here we look at the large drops in the actual data and spot the point where it levels off to the right. Also, we locate the point of inflection – the point where the gap between simulated data and actual data tends to be minimum.

Looking at this plot and parallel analysis, anywhere between 20 to 40 factors would be a good choice.

A general rule of thumb is that if the absolute value of the standardized loading is greater than 0.3, the variable is relevant for the particular factor

```{r}
#  consider the loadings more than 0.3 and not loading on more than one factor
# negative values are acceptable
print(factor26$loadings,cutoff = 0.3)
```

```{r}
fa.diagram(factor26)
summary(factor26)
```

The root mean square of residuals (RMSR) is 0.04. This is acceptable as this value should be closer to 0. 

RMSEA (root mean square error of approximation) index. Its value, 0 shows the good model fit as it’s below 0.05. 
Tucker-Lewis Index (TLI) is 1.207 – an acceptable value considering it’s over 0.9.

###Significant Loadings:

*Soil Type*
soil_type3  0.326     loam                              
soil_type4  -0.321    clay loam                        
soil_type5  -0.317    sandy loam

*Current Operational Status of Plot*
cur_opr_status5 0.325
cur_opr_status6 0.313
cur_opr_status9 0.430      

*How was plot acquired?*
how_acq1  -0.313      purchased/bought
how_acq2  0.302       inherited (wife's family)                                                 
how_acq3  -0.332      inherited (husband's family)
how_acq5  -0.338      User right *=(husband;s family)

*In last 12 months, who decided to build any infrastructure on this plot?*
who_infra_family0 -0.707
who_infra_family1 0.707  

*What kind of toilet facility do members of your household use most of the time?*
main_use1 0.304
main_use12  -0.433

*How many households live in this house?*
house_sharing0  -0.470                                                                                                  
house_sharing1  -0.319 
house_sharing3  0.340   

*How many rooms does your household occupy?*
house_rooms -0.372

*How many rooms are used for sleeping?*
house_rooms_sleeping  -0.469    

*What is your main source of cooking fuel?*
fuel_source5  -0.468  

*House wall and roof material*
housewall_material5 0.321
houseroof_material6 -0.433

*What is your main source of lighting fuel?*
lighting_source3  -0.535                                                                                                            

*What type of latrine do you use?*
latrine_type3 0.302      Pucca (unsealed)                                    
latrine_type5 -0.327     Sanitary w flash (water sealed)

*About how many latrines would you say members of your household have access to?*
count_latrine 0.336                                                                                                                             
*Do you use any drinking water purifying process?*
water_purify4 -0.363     Boiled and Filtered

*How do you dispose garbage?*
garbage5  0.354          Burnt/buried                                                                                               

*Number of facilities frequently visited*
fac_count 0.368                                                                                                                     

*Number of children*
numChildren 0.319   

*Percent of household who can stand on their own*
pctCanStandOwn  0.337   

# Subjective Wellbeing

Crowdsourced subjective wellbeing.

```{r}
library(faraway)
wellbeing <- `69. SubjectiveWellbeing.dta` %>% filter(crowdsource == 1)
map(wellbeing, ~sum(is.na(.)))
wellbeing <- wellbeing %>% select(hh_ID, submissiondate,week_number,personality1)

##########
# if there is a hh_ID duplicate, use the first entry
##########
wellbeing$submissiondate <- as.Date(wellbeing$submissiondate, "%b %d, %Y")
wellbeing <- setDT(wellbeing)[wellbeing[, .I[which.min(submissiondate)], by=hh_ID]$V1]
wellbeing <- wellbeing %>% select(-submissiondate)
##########

wellbeing_df <- merge(wellbeing, final_hh_data_noNAs, by = "hh_ID")

```


# Lasso and Ridge Regression for Variable Selection

```{r}
library(faraway)
split <- sample.split(rownames(final_hh_data_noNAs),SplitRatio = 0.80)
train <- df[split == T , ];str(train)
test <- df[split == F , ] ; str(test)
```

