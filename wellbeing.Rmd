---
title: "Economic Well-Being in Bagladesh"
author: "Mari Roberts"
date: "4/7/2020"
output: pdf_document
---

```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
# load necessary packages
requiredPackages = c('foreign', # read dta
                     'dplyr', # data manipulation
                     'haven',
                     'gridExtra', # data manipulation
                     'readr', # read files
                     'readxl',# read files
                     'dummies', # PCA
                     'lubridate', # data manipulation
                     'data.table', # data manipulation
                     'FactoMineR', # PCA
                     'factoextra', # PCA
                     'lattice', # plots
                     'ggplot2', # plots
                     'tidyverse') # missing values using map
# only downloads packages if needed
for(p in requiredPackages){
  if(!require(p,character.only = TRUE)) install.packages(p)
  library(p,character.only = TRUE)
}

# set wd
mydirectory <- "/Users/mari/AgricultureModel/Datasets"
setwd(mydirectory)

filenames <- list.files(path=mydirectory, pattern=".*dta")

# read in each dta file
filenames <- list.files(path=mydirectory, pattern=".*dta")
for (i in 1:length(filenames)){
  assign(filenames[i], read_dta(paste("", filenames[i], sep=''))
  )}
```

# Questions Asked Once

```{r include=FALSE}
####################################################
## Health and Demographics
####################################################

##########################
# Basic Info
##########################

# find number of hh members for calculations later
hh_count <- HouseholdComposition_level_1.dta %>% select(hh_ID, member_1_ID, hh_members) 
hh_count <- hh_count %>% distinct(hh_ID, .keep_all = TRUE)

# rename variables
hh_all <- HouseholdComposition_members_level_2.dta %>% mutate(height_meters = tot_height_inch*0.0254,
                                                              canStandOwn = hhm_health1,
                                                              canWalk5Km = hhm_health2,
                                                              canCarry20L = hhm_health3)

# BMI categories
hh_all <- hh_all %>% mutate(bmi = (weight_kg/(height_meters^2)))

# remove outliers for weight and height
hh_all <- hh_all %>% filter(tot_height_inch >= 1 & tot_height_inch <= 100)
hh_all <- hh_all %>% filter(weight_kg >= 1 & weight_kg <= 100)

# create BMI categories
hh_all <- hh_all %>% mutate(bmiCategory = ifelse(bmi >= 30, "obese", 
                                          ifelse(bmi >=25, "overweight", 
                                          ifelse(bmi >=18.5, "normal", 
                                          ifelse(bmi < 18.5, "underweight", NA)))))

# combine 0 and 77 ("no" and "don't know")
hh_all <- hh_all %>% mutate(canCarry20L = ifelse(canCarry20L==77 | canCarry20L==0, 0, 1),
                            canWalk5Km = ifelse(canWalk5Km==77 | canWalk5Km==0, 0, 1),
                            canStandOwn = ifelse(canStandOwn==77 | canStandOwn==0, 0, 1))

# 0 = male, 1 = female 
# select demographic variables
hh_all <- hh_all %>% mutate(sex = ifelse(hhm_sex == 1,0,1)) %>% 
                       select(hh_ID,
                              member_1_ID,
                              hhm_relation,
                              sex,
                              age = hhm_age,
                              maritalStatus = marital_status,
                              literacy,
                              education,
                              attendingCollege = hhm_attending,
                              occupationType = hhm_occu_type,
                              canCarry20L,
                              canWalk5Km,
                              canStandOwn,
                              bmi,
                              bmiCategory)

# change into factor variables
hh_all$sex = factor(hh_all$sex)
hh_all$maritalStatus = factor(hh_all$maritalStatus)
hh_all$literacy = factor(hh_all$literacy)
hh_all$education = factor(hh_all$education)
hh_all$occupationType = factor(hh_all$occupationType)
hh_all$bmiCategory = factor(hh_all$bmiCategory)

# does hh have children?
hh_all <- hh_all %>% mutate(isChild = ifelse(age>=18, 0, 1))
hh_children <- hh_all %>% group_by(hh_ID) %>% tally(isChild)
hh_children <- hh_children %>% mutate(numChildren = n) %>% select(hh_ID, numChildren)

# merge datasets
hh_all <- merge(hh_children, hh_all, by = "hh_ID")
  
##########################
# Data by resondents
##########################

# data about respondents
hh_respondent <- hh_all %>% filter(hhm_relation == 1)

##########################
# Health by Household
##########################

# count health measures per household
hh_subset <- hh_all %>% select(hh_ID, member_1_ID, bmi, canCarry20L, canWalk5Km, canStandOwn)
          carry <- hh_subset %>% group_by(hh_ID) %>% tally(canCarry20L)
          walk <- hh_subset %>% group_by(hh_ID) %>% tally(canWalk5Km)
          stand <- hh_subset %>% group_by(hh_ID) %>% tally(canStandOwn)

# determine percentage of health measure per household
hh_health <- merge(hh_count, carry, by = "hh_ID") 
hh_health <- merge(hh_health, walk, by = "hh_ID") 
hh_health <- merge(hh_health, stand, by = "hh_ID") 
hh_health <- hh_health %>% select(hh_ID,
                                    member_1_ID,
                                    hh_members,
                                    canCarry20L = n.x,
                                    canWalk5Km = n.y,
                                    canStandOwn = n) %>% 
                             mutate(pctCanCarry20L = canCarry20L/hh_members,
                                    pctCanWalk5Km = canWalk5Km/hh_members,
                                    pctCanStandOwn = canStandOwn/hh_members)

# remove percentages above 100, differences in number of members
hh_health <- hh_health %>% filter(pctCanCarry20L <= 1 &
                                  pctCanWalk5Km <= 1 &
                                  pctCanStandOwn <= 1) %>% select(-canCarry20L,-canWalk5Km,-canStandOwn)

hh_char <- merge(hh_health, hh_children, by = "hh_ID")
hh_char <- hh_char %>% select(-member_1_ID)

# TRUE, if there are no duplicates in hh_ID
# length(unique(hh_char$hh_ID)) == nrow(hh_char)
```

```{r}
####################################################
## Housing Characteristics
####################################################

# housing and sanitation characteristics
housing_all <- `41. HousingandSanitation.dta` 

##########
# if there is a hh_ID duplicate, use the first entry
# question was only supposed to be answered once but some households submitted twice
##########
# TRUE, if there are no duplicates in hh_ID
# length(unique(housing_all$hh_ID)) == nrow(housing_all)
housing_all$submissiondate <- as.Date(housing_all$submissiondate, "%b %d, %Y")
housing_all <- setDT(housing_all)[housing_all[, .I[which.min(submissiondate)], by=hh_ID]$V1]
housing_all <- housing_all %>% select(-submissiondate)
##########

# respondent input year instead of years old
# determine house age
housing_fix_year <- housing_all %>% arrange(desc(house_old))
housing_fix_year <- head(housing_fix_year, 19)
housing_fix_year <- housing_fix_year %>% select(hh_ID, house_old, today)
housing_fix_year$today <- as.Date(housing_fix_year$today, "%b %d, %Y")
housing_fix_year$submissionyear <- as.numeric(format(housing_fix_year$today,'%Y'))
housing_fix_year<- housing_fix_year %>% mutate(house_age = submissionyear-house_old) %>% select(hh_ID, house_age)
housing_all_not_fix_year <- housing_all %>% filter(hh_ID != 115161 &
                                        hh_ID != 120230 &
                                        hh_ID != 105055 &
                                        hh_ID != 221250 &
                                        hh_ID != 233386 &
                                        hh_ID != 120238 &
                                        hh_ID != 222252 &
                                        hh_ID != 240474 &
                                        hh_ID != 108087 &
                                        hh_ID != 120228 &
                                        hh_ID != 230349 &
                                        hh_ID != 235414 &
                                        hh_ID != 231368 &
                                        hh_ID != 115165 &
                                        hh_ID != 235407 &
                                        hh_ID != 229339 &
                                        hh_ID != 224284 &
                                        hh_ID != 232370) %>% select(hh_ID, house_old)
housing_all_not_fix_year <- housing_all_not_fix_year %>% mutate(house_age = house_old) %>% select(-house_old)
housing_all_years_fixed <- merge(housing_all_not_fix_year, housing_fix_year, by = c("hh_ID"), all=TRUE)
housing_all_years_fixed <- housing_all_years_fixed %>% select(hh_ID, house_age = house_age.x)

# select variables
housing_all <- housing_all %>% select(-sanitation_1_ID,-expiration_date,
                                      -max_submissions,-task_value,-task_length,-recall,
                                      -recall_length,-crowdsource,-week_number,-start_time,
                                      -end_time, -today, -start_date, -house, -house_old)

# merge datasets
housing_all <- merge(housing_all_years_fixed, housing_all, by = c("hh_ID"))

# water_purify - too many factor levels
housing_all <- housing_all %>% mutate(does_water_purify = ifelse(water_purify==1, 0, 1))

# garbage - too many factor levels
housing_all <- housing_all %>% mutate(garbage_collected = ifelse(garbage==1|garbage==2, 1, 0))

# lighting_source - too many factor levels - What is your main source of lighting fuel?
housing_all <- housing_all %>% mutate(lighting_source_elec = ifelse(lighting_source==1 | lighting_source==3, 1, 0))

# fuel_source - too many factor levels - What is your main source of cooking fuel?
housing_all <- housing_all %>% mutate(fuel_source_wood = ifelse(fuel_source==5, 1, 0))

# housing materials - too many factor levels, combine smaller levels
housing_all$housefloor_material = as.factor(
    ifelse(housing_all$housefloor_material %in% c('1'),
        'concrete',
        ifelse(housing_all$housefloor_material %in% c('2','3','5','99'),'other','mud'))
)
housing_all$houseroof_material = as.factor(
    ifelse(housing_all$houseroof_material %in% c('2'), 'tin','other'))

housing_all$housewall_material = as.factor(
    ifelse(housing_all$housewall_material %in% c('1'),
        'concrete',
        ifelse(housing_all$housewall_material %in% c('3','4','5','8'),'other','tin'))
)

# remove variables 
housing_all <- housing_all %>% select(-rent_paid, 
                                          -housewall_material_other,
                                          -housefloor_material_other,
                                          -houseroof_material_other,
                                          -house_supply_off,
                                          -house_elec_cost,
                                          -lighting_source_other,
                                          -lighting_source,
                                          -latrine_other,
                                          -latrine_type,
                                          -drinking_other,
                                          -water_other,
                                          -water_purify,
                                          -water_other_purpose, # not informative
                                          -drinking_source,
                                          -water_purify_other,
                                          -arsenic_check,
                                          -color_check,
                                          -handpump,
                                          -garbage_other,
                                          -garbage,
                                          -fuel_source,
                                          -fuel_source_other)
# check NAs
map(housing_all, ~sum(is.na(.)))

# check data format types
# str(housing_all)

#################
# order factor variables
#################
# house wall, roof, and floor
housing_all$housewall_material <- factor(housing_all$housewall_material, ordered = TRUE,
                                         levels = c("concrete","tin","other"))
housing_all$houseroof_material <- factor(housing_all$houseroof_material, ordered = TRUE,
                                         levels = c("tin","other"))
housing_all$housefloor_material <- factor(housing_all$housefloor_material, ordered = TRUE,
                                          levels = c("concrete","mud","other"))

# > table(housing_all$houseroof_material)
#   1   2   3   4   5   6   7 
#   9 238   9   3  73   1   2 

# > table(housing_all$housewall_material)
#   1   2   3   4   5   8 
# 159 115   9   9  42   1 

# > table(housing_all$housefloor_material)
#   1   2   3   4   5  99 
# 113   2   3 212   2   3 

##########
# factor variables
##########
housing_all$house_elec  <- factor(housing_all$house_elec)
housing_all$fuel_source_wood  <- factor(housing_all$fuel_source_wood)
housing_all$lighting_source_elec  <- factor(housing_all$lighting_source_elec)
housing_all$water_supply  <- factor(housing_all$water_supply)
housing_all$drinking_source_same <- factor(housing_all$drinking_source_same)
housing_all$does_water_purify <- factor(housing_all$does_water_purify)
housing_all$garbage_collected <- factor(housing_all$garbage_collected)

str(housing_all)
```

```{r}
####################################################
## Latrine and Water
####################################################

# select variables
latrine_all <- `87. latrineUse.dta` %>% select(hh_ID, submissiondate, use_lat, main_use, count_latrine, pct_open)

# main_use  - too many factor levels (change to flush or no flush)
temp <- c("1","2","3","4","5","6")
latrine_all$main_use_flush <- ifelse(grepl(paste(temp, collapse = "|"),latrine_all$main_use), 1, 0)
latrine_all <- latrine_all %>% select(-main_use)

# pct_open  - too many factor levels (change to defacate or doesn't defacate in public)
latrine_all$defecation_public <- ifelse(grepl("1",latrine_all$pct_open), 1, 0)
latrine_all <- latrine_all %>% select(-pct_open)

# remove outliers for latrine count
latrine_all <- latrine_all %>% filter(count_latrine >= 0 & count_latrine <= 10)

##########
# if there is a hh_ID duplicate, use the first entry
##########
latrine_all$submissiondate <- as.Date(latrine_all$submissiondate, "%b %d, %Y")
latrine_all <- setDT(latrine_all)[latrine_all[, .I[which.min(submissiondate)], by=hh_ID]$V1]
latrine_all <- latrine_all %>% select(-submissiondate)
##########

##########
# factor variables
##########

latrine_all$use_lat <- factor(latrine_all$use_lat)
latrine_all$main_use_flush <- factor(latrine_all$main_use_flush)
latrine_all$defecation_public <- factor(latrine_all$defecation_public)

# check for NAs
# map(latrine_all, ~sum(is.na(.)))

# merge datasets
housing_all <- merge(latrine_all, housing_all, by = c("hh_ID"))
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]

str(housing_all)
```

```{r}
####################################################
## Non-agricultural enterprise
####################################################

# Anyone in household owned/operated any business in 12 months?
nonagricultural_enterprise <- `57. NonAgriculturalEnterprise_level_1.dta` %>% select(hh_ID, submissiondate, business)

##########
# if there is a hh_ID duplicate, use the first entry
##########
nonagricultural_enterprise$submissiondate <- as.Date(nonagricultural_enterprise$submissiondate, "%b %d, %Y")
nonagricultural_enterprise <- setDT(nonagricultural_enterprise)[nonagricultural_enterprise[, .I[which.min(submissiondate)], by=hh_ID]$V1]
nonagricultural_enterprise <- nonagricultural_enterprise %>% select(-submissiondate)
##########

##########
# factor variables
##########

nonagricultural_enterprise$business <- factor(nonagricultural_enterprise$business)

# merge with household characteristics
housing_all <- merge(nonagricultural_enterprise, housing_all, by = c("hh_ID"))
# housing_all$hh_ID[duplicated(housing_all$hh_ID)]
#str(housing_all)
```

```{r}
####################################################
## Facilities
####################################################

facilities <- `20. Facilities_level_1.dta` %>% select(hh_ID,submissiondate, facilities, fac_count)

# there are too many variations on the types of facilities visited, so change to:
# visits health centers, bazaar, local shops
facilities$visits_healthcenter <- ifelse(grepl("1",facilities$facilities), 1, 0)
facilities$visits_bazaar <- ifelse(grepl("6",facilities$facilities), 1, 0)
facilities$visits_localshop <- ifelse(grepl("5",facilities$facilities), 1, 0)
facilities <- facilities %>% select(-facilities)

##########
# if there is a hh_ID duplicate, use the first entry
##########
facilities$submissiondate <- as.Date(facilities$submissiondate, "%b %d, %Y")
facilities <- setDT(facilities)[facilities[, .I[which.min(submissiondate)], by=hh_ID]$V1]
facilities <- facilities %>% select(-submissiondate)
##########

##########
# factor variables
##########
facilities$visits_healthcenter <- factor(facilities$visits_healthcenter)
facilities$visits_bazaar <- factor(facilities$visits_bazaar)
facilities$visits_localshop <- factor(facilities$visits_localshop)

# merge with household characteristics
housing_all <- merge(facilities, housing_all, by = c("hh_ID"))
#str(housing_all)
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]
```

```{r}
####################################################
## Farming Plots
####################################################

# merge plot datasets together
plots <- Plots_plot_level_2.dta # fix year
temp <- plots_level_1.dta %>% select(hh_ID, submissiondate, plot_1_ID, today) 
plots <- merge(plots, temp, by=c("hh_ID","plot_1_ID"))

# determine plot age
plots$today <- format(as.Date(plots$today, format="%b %d, %Y"),"%Y")
plots$yr_acq <- format(as.Date(plots$yr_acq, format="%b %d, %Y"),"%Y")  
plots$today <- as.numeric(plots$today)
plots$yr_acq <- as.numeric(plots$yr_acq)
plots$plot_age <- plots$today - plots$yr_acq 

# too many plot types (change to three types: homestead, cultivable, other)
plots$plot_type_homestead <- ifelse(grepl("1",plots$plot_type), 1, 0)
temp <- c("2","8")
plots$plot_type_cultivable_land_pond <- ifelse(grepl(paste(temp, collapse = "|"),plots$plot_type), 1, 0)
# temp <- c("3","4","5","6","7","9"," ")
# plots$plot_type_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$plot_type), 1, 0)

# who_owns - too many factor levels (change to three types)
plots$who_owns_male <- ifelse(grepl("1",plots$who_owns), 1, 0)
plots$who_owns_family <- ifelse(grepl("2",plots$who_owns), 1, 0)
# temp <- c("3","4","5","6")
# plots$who_owns_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_owns), 1, 0)

# who_owns_off - too many factor levels (change to three types)
plots$who_owns_off_male <- ifelse(grepl("1",plots$who_owns_off), 1, 0)
plots$who_owns_off_family <- ifelse(grepl("2",plots$who_owns_off), 1, 0)
# temp <- c("3","4","5","6")
# plots$who_owns_off_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_owns_off), 1, 0)
 
# who_decision - too many factor levels (change to three types)
plots$who_decision_male <- ifelse(grepl("1",plots$who_decision), 1, 0)
plots$who_decision_family <- ifelse(grepl("2",plots$who_decision), 1, 0)
# temp <- c("3","4","5","6")
# plots$who_decision_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_decision), 1, 0)

# who_responsible - not enough responses, didn't include

# who_dec_spd - too many factor levels (change to three types)
plots$who_dec_spd_male <- ifelse(grepl("1",plots$who_dec_spd), 1, 0)
plots$who_dec_spd_family <- ifelse(grepl("2",plots$who_dec_spd), 1, 0)
# temp <- c("3","4","5","6")
# plots$who_dec_spd_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_dec_spd), 1, 0)

# who_infra - too many factor levels (change to three types)
plots$who_infra_male <- ifelse(grepl("1",plots$who_infra), 1, 0)
plots$who_infra_family <- ifelse(grepl("2",plots$who_infra), 1, 0)
# temp <- c("3","4","5","6")
# plots$who_infra_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$who_infra), 1, 0)

# cur_opr_status - too many factor levels (change to three types)
plots$cur_opr_status_fallow <- ifelse(grepl("1",plots$cur_opr_status), 1, 0)
plots$cur_opr_status_own <- ifelse(grepl("2",plots$cur_opr_status), 1, 0)
# temp <- c("3","4","5","6","7","8","9","11")
# plots$cur_opr_status_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$cur_opr_status), 1, 0)

# how_acq  - too many factor levels (change to three types)
plots$how_acq_bought <- ifelse(grepl("1",plots$how_acq), 1, 0)
plots$how_acq_inherited <- ifelse(grepl("2",plots$how_acq), 1, 0)
# temp <- c("3","4","5","6")
# plots$how_acq_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$how_acq), 1, 0)

# plot_use  - too many factor levels (change to four types)
plots$plot_use_agriculture <- ifelse(grepl("1",plots$plot_use), 1, 0)
plots$plot_use_fisheries <- ifelse(grepl("2",plots$plot_use), 1, 0)
plots$plot_use_livestock <- ifelse(grepl("2",plots$plot_use), 1, 0)
# temp <- c("3","4","5","6","7","99")
# plots$plot_use_other <- ifelse(grepl(paste(temp, collapse = "|"),plots$plot_use), 1, 0)

##########
# if there is a hh_ID duplicate, use the first entry
##########
# 100+ duplicates
plots$hh_ID[duplicated(plots$hh_ID)]
plots$submissiondate <- as.Date(plots$submissiondate, "%b %d, %Y")
plots <- setDT(plots)[plots[, .I[which.min(submissiondate)], by=hh_ID]$V1]
plots <- plots %>% select(-submissiondate)
##########

# select final variables
plots <- plots %>%  select( hh_ID,
                            plot_type_homestead,
                            plot_type_cultivable_land_pond,
                            #plot_type_other,
                            size_plot,
                            flood_depth, # wrong units probably
                            dis_from_home,
                            soil_type,
                            cur_opr_status_fallow,
                            cur_opr_status_own,
                            #cur_opr_status_other,
                            #amt_rec, too many NAs
                            cur_mv,
                            how_acq_bought,
                            how_acq_inherited,
                            #how_acq_other,
                            plot_age,
                            plot_use_agriculture,
                            plot_use_fisheries,
                            plot_use_livestock,
                            #plot_use_other,
                            #work_last_seas,  too many NAs
                            # In last 12 months, who decided to build any infrastructure on this plot?
                            who_infra_male,
                            who_infra_family,
                            #who_infra_other,
                            # Who uses the plot?  
                            who_owns_male,
                            who_owns_family,
                            #who_owns_other,
                            # Who officially owns?
                            who_owns_off_male,
                            who_owns_off_family,
                            #who_owns_off_other,
                            # who_decision who takes most decisions regarding type of crop to be planted or fish to be raised?
                            who_decision_male,
                            who_decision_family,
                            #who_decision_other,
                            # who decides how to spend revenues generated from crops or fish?
                            who_dec_spd_male,
                            who_dec_spd_family)
                            #who_dec_spd_other)

##########
# factor variables
##########
plots$plot_type_homestead <- factor(plots$plot_type_homestead)
plots$plot_type_cultivable_land_pond <- factor(plots$plot_type_cultivable_land_pond)
plots$soil_type <- factor(plots$soil_type)
plots$cur_opr_status_fallow <- factor(plots$cur_opr_status_fallow)
plots$cur_opr_status_own <- factor(plots$cur_opr_status_own)
plots$how_acq_bought <- factor(plots$how_acq_bought)
plots$how_acq_inherited <- factor(plots$how_acq_inherited)
plots$plot_use_agriculture <- factor(plots$plot_use_agriculture)
plots$plot_use_fisheries <- factor(plots$plot_use_fisheries)
plots$plot_use_livestock <- factor(plots$plot_use_livestock)
plots$who_infra_male <- factor(plots$who_infra_male)
plots$who_infra_family <- factor(plots$who_infra_family)
plots$who_owns_male <- factor(plots$who_owns_male)
plots$who_owns_family <- factor(plots$who_owns_family)
plots$who_owns_off_male <- factor(plots$who_owns_off_male)
plots$who_owns_off_family <- factor(plots$who_owns_off_family)
plots$who_decision_male <- factor(plots$who_decision_male)
plots$who_decision_family <- factor(plots$who_decision_family)
plots$who_dec_spd_male <- factor(plots$who_dec_spd_male)
plots$who_dec_spd_family <- factor(plots$who_dec_spd_family)

# check for NAs
# map(plots, ~sum(is.na(.)))

# merge with household characteristics
housing_all <- merge(plots, housing_all, by = c("hh_ID"))
#housing_all$hh_ID[duplicated(housing_all$hh_ID)]
str(housing_all)
```

```{r}
# merge datasets
hh_data <- merge(housing_all, hh_char, by = "hh_ID")
str(hh_data)
#hh_data$hh_ID[duplicated(hh_data$hh_ID)]

#########################################################
# Separate categorical variables and continuous variables
#########################################################
categorical_variables <- hh_data %>% select(-size_plot, 
                                            -flood_depth, 
                                            -dis_from_home, 
                                            -cur_mv, 
                                            -plot_age, 
                                            -fac_count,
                                            -count_latrine, 
                                            -rent_estimate, 
                                            -house_age,
                                            -rent_estimate,
                                            -house_rooms, 
                                            -house_rooms_sleeping,
                                            -house_sharing,
                                            -house_age, 
                                            -fuel_cost, 
                                            -lighting_cost, 
                                            -cell_cost, 
                                            -cellphone,
                                            -fac_count,
                                            -numChildren,
                                            -pctCanCarry20L,
                                            -pctCanWalk5Km,
                                            -pctCanStandOwn,
                                            -hh_members)
continuous_variables <- hh_data %>% select(hh_ID,
                                           size_plot, 
                                            flood_depth, 
                                            dis_from_home, 
                                            cur_mv, 
                                            plot_age, 
                                            fac_count,
                                            count_latrine, 
                                            rent_estimate, 
                                            house_age,
                                            rent_estimate,
                                            house_rooms, 
                                            house_rooms_sleeping,
                                            house_sharing,
                                            house_age, 
                                            fuel_cost, 
                                            lighting_cost, 
                                            cell_cost, 
                                            cellphone,
                                            fac_count,
                                            numChildren,
                                            pctCanCarry20L,
                                            pctCanWalk5Km,
                                            pctCanStandOwn,
                                            hh_members)

# scale continuous variables
continuous_variables1 <- apply(continuous_variables[,2:22], 2, scale)
continuous_variables <- data.frame(continuous_variables1,continuous_variables$hh_ID)
continuous_variables <- continuous_variables %>% mutate(hh_ID = continuous_variables.hh_ID) %>% select(-continuous_variables.hh_ID)

##################################
# combine continous and categorical into one dataset
##################################

# merge categorical and continous variables into one dataframe
final_hh_data <- merge(categorical_variables, continuous_variables, by ="hh_ID")

# remove NAs
final_hh_data_noNAs <- final_hh_data[complete.cases(final_hh_data),]
# recode dummy frame
final_hh_data_noNAs <- dummy.data.frame(final_hh_data_noNAs)
```

# PCA

# Figure out dimensions of well-being using Factor Analysis

http://www.di.fc.ul.pt/~jpn/r/factoranalysis/factoranalysis.html#factor-analysis-vs.pca

# Food Diary
```{r}

# Which of the following groups of foods were consumed by members of your household in the last ${recall_length} hours?
# Scroll carefully down the list and select all that apply.

# select noncrowdsourced data
fooddiary_1 <- `33.FoodDiary_level_1.dta` %>% filter(crowdsource==0)

# select variables
fooddiary_1 <- fooddiary_1 %>% select(hh_ID, 
                                      food_1_ID,
                                      submissiondate, 
                                      recall, # month 516 season 272 week 4944
                                      week_number, #3:50 weeks
                                      # gender, 
                                      # age, 
                                      # education, 
                                      # highest_class, 
                                      # relationship, 
                                      food_list, # groups of foods consumed
                                      food_count) # number of foods selected
fooddiary_2 <- `34. FoodDiary_food_level_2.dta` %>% select(hh_ID, 
                                      food_1_ID,
                                      food_2_ID,
                                      food_grp_namec, 
                                      food_type) #will require grepl
fooddiary_3 <- `35. Fooddiary_food_foodtype_level_3.dta` %>% select(hh_ID, 
                                      food_2_ID,
                                      food_3_ID,
                                      food_ID = food_type_name, 
                                      food_type_quant,
                                      food_type_unit,
                                      quant_pur, #How much consumed was purchased?
                                      quant_own, #How much consumed was own production?
                                      quant_other) #How much consumed was from other sources?

# duplicate rows based on food_count - not necessary
# fooddiary_1 <- fooddiary_1[rep(seq(nrow(fooddiary_1)), fooddiary_1$food_count),]

# merge levels 1 and 2
fooddiary_1_2 <- merge(fooddiary_1,fooddiary_2, by=c("hh_ID","food_1_ID"))

# merge with level 3
fooddiary_all <- merge(fooddiary_1_2,fooddiary_3, by=c("hh_ID","food_2_ID"))

# remove unwanted variables
# fooddiary_all <- fooddiary_all %>% select(-food_1_ID,-food_2_ID,-food_3_ID,-food_type)
fooddiary_all <- fooddiary_all %>% select(-food_type)

# 118 food_type_name are missing
# map(fooddiary_all, ~sum(is.na(.)))
# remove missing values for now.
fooddiary_all <- fooddiary_all[complete.cases(fooddiary_all),]
```

*Food Type Unit*
9,262 1 Kg
8,285 2 Grams
205 3 Liter
308 4 Milliliter
591 5 Tablespoon
391 6 Teaspoon
208 7 Drops
3,088 8 Count

```{r}
# food names
rm(list=(ls()[ls()!="fooddiary_all"])) # remove everything from environment except fooddiary_all
food_list <- read_csv("Datasets/food_list.csv")
food_calories <- read_csv("Datasets/food_cal.csv")
food_calories <- food_calories %>% mutate(food_name = food_type)  %>% 
                                   select(-food_type)
food_info <- merge(food_calories, food_list, by="food_name")

##############################
# some calories are zero, fix?????????
##############################
# Carbohydrates provide 4 calories per gram, protein provides 4 calories per gram, and fat provides 9 calories per gram
# food_info <- food_info %>% filter(calorie_grams != 0)

# merge with food list names 
fooddiary_cleaned <- merge(food_info, fooddiary_all, by="food_ID")
fooddiary_cleaned <- fooddiary_cleaned %>% select(hh_ID,
                                                  submissiondate,
                                                  recall,
                                                  week_number,
                                                  food_ID,
                                                  food_count,
                                                  food_name,
                                                  food_name_type,
                                                  food_type_quant,
                                                  food_type_unit,
                                                  quant_pur,
                                                  quant_own,
                                                  quant_other,
                                                  food_1_ID,
                                                  food_2_ID,
                                                  food_3_ID)

# percent purchased, grown, other
fooddiary_cleaned <- fooddiary_cleaned %>% mutate(quant_pur_pct = quant_pur/food_type_quant,
                                                  quant_own_pct = quant_own/food_type_quant,
                                                  quant_other_pct = quant_other/food_type_quant)

# merge with food calories/info
fooddiary_cleaned <- merge(fooddiary_cleaned, food_info, by=c("food_ID","food_name_type","food_name"))

# reorder variables
fooddiary_cleaned <- fooddiary_cleaned %>% select(hh_ID,
                                                  submissiondate,
                                                  recall,
                                                  week_number,
                                                  food_ID,
                                                  food_count,
                                                  food_name,
                                                  food_name_type,
                                                  food_type_quant,
                                                  food_type_unit,
                                                  calories_grams,
                                                  quant_pur,
                                                  quant_own,
                                                  quant_other,
                                                  quant_pur_pct,
                                                  quant_own_pct,
                                                  quant_other_pct,
                                                  food_1_ID,
                                                  food_2_ID,
                                                  food_3_ID)

# fix dates and times
fooddiary_cleaned <- fooddiary_cleaned %>%
  mutate(datetime = as.POSIXct(strptime(submissiondate, format = "%b %d, %Y %I:%M:%S %p")),
         datetime_military = strftime(datetime, format = "%Y-%m-%d %H:%M"))

# extract month
fooddiary_cleaned$submission_month <- month(fooddiary_cleaned$datetime)
# extract weekday
fooddiary_cleaned$submission_weekday <- weekdays(fooddiary_cleaned$datetime)
# create breaks

# time of day
# breaks <- hour(hm("00:00", "6:00", "12:00", "18:00", "23:59"))
# # labels for the breaks
# labels <- c("Night", "Morning", "Afternoon", "Evening")
# fooddiary_cleaned$time_of_day <- cut(x=hour(fooddiary_cleaned$datetime), 
#                                      breaks = breaks, 
#                                      labels = labels, include.lowest=TRUE)
```

*Calculate average caloric intake per person in each household*
```{r fig1, fig.height = 4, fig.width = 4}
# 1	Kg          *1000
# 2	Grams
# 3	Liter       *1000
# 4	Milliliter  /1000
# 5	Tablespoon  *15
# 6	Teaspoon    *4.2
# 7	Drops       *0.05
# 8	Count

# unit conversions
fooddiary_cleaned <- fooddiary_cleaned %>% 
  mutate(calories_total_grams = case_when((food_type_unit==1) ~ calories_grams*(food_type_quant*1000),
                                          (food_type_unit==2) ~ calories_grams*food_type_quant,
                                          (food_type_unit==3) ~ calories_grams*(food_type_quant*1000),
                                          (food_type_unit==4) ~ calories_grams*(food_type_quant/1000),
                                          (food_type_unit==5) ~ calories_grams*food_type_quant,
                                          (food_type_unit==6) ~ calories_grams*(food_type_quant*4.2),
                                          (food_type_unit==7) ~ calories_grams*(food_type_quant*0.05)))

# rearrange columns
fooddiary_cleaned <- fooddiary_cleaned %>% select(hh_ID,
                                                  submissiondate,
                                                  recall,
                                                  week_number,
                                                  food_ID,
                                                  food_count,
                                                  food_name,
                                                  food_name_type,
                                                  food_type_quant,
                                                  food_type_unit,
                                                  calories_grams,
                                                  calories_total_grams,
                                                  quant_pur,
                                                  quant_own,
                                                  quant_other,
                                                  quant_pur_pct,
                                                  quant_own_pct,
                                                  quant_other_pct,
                                                  datetime,
                                                  datetime_military,
                                                  submission_month,
                                                  submission_weekday,
                                                  #time_of_day,
                                                  food_1_ID,
                                                  food_2_ID,
                                                  food_3_ID)
```

```{r}

#####################################
# fix food units claimed as "counts"
#####################################
fooddiary_count <- fooddiary_cleaned %>% filter(food_type_unit == 8) %>% arrange(desc(food_name_type))

# grains (changed to kg)
fooddiary_count <- fooddiary_count %>% mutate(calories_total_grams = case_when(food_name=="Parboiled rice (coarse)" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Fine rice" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Atta" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Non-parboiled rice (coarse)" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Semai/noodles" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Chira (flattened rice)" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Muri/Khoi (puffed rice)" ~ calories_grams*food_type_quant*1000,
# meats (mostly changed to kg)
                                                food_name=="Beef/buffalo" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Mutton" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Chicken" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Pigeon" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Fish egg" ~ calories_grams*food_type_quant, # egg roe = 1g
                                                food_name=="Egg" ~ calories_grams*food_type_quant*50, # egg = 50g
                                                food_name=="Duck" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Stomach of beef/goat" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Dried meat" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Bids/bok/gughu" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Liver" ~ calories_grams*food_type_quant*1000,
# drinks/dairy (can = 340grams/12 fl oz)
                                                food_name=="Tea –prepared" ~ calories_grams*food_type_quant*340,
                                                food_name=="Coke/ Seven-up etc/Pepci/RC/Urocola etc" ~ calories_grams*food_type_quant*340,
                                                food_name=="Milk" ~ calories_grams*food_type_quant*340,
                                                food_name=="Milk in Tea" ~ calories_grams*food_type_quant*340,
                                                food_name=="Powdered Milk" ~ calories_grams*food_type_quant*35,# serving of powdered milk
                                                food_name=="Condensed Milk" ~ calories_grams*food_type_quant*340,
                                                food_name=="Butter" ~ calories_grams*food_type_quant*113, # serving of butter
                                                food_name=="Yogurt" ~ calories_grams*food_type_quant*340,
                                                food_name=="Cottage cheese or Paneer" ~ calories_grams*food_type_quant*340, 
                                                food_name=="Buttermilk" ~ calories_grams*food_type_quant*340, 
                                                food_name=="Solid Cheese Curds" ~ calories_grams*food_type_quant*340, 
                                                food_name=="Ice Cream" ~ calories_grams*food_type_quant*340,
                                                food_name=="Ice cream" ~ calories_grams*food_type_quant*340,
# fish small (avg  serving size 170)
# some gura mach in 500 for quantity.....fix later???????
                                                 food_name=="Gura mach" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Panch mishali" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Palshe" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Tatkeni" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Puti" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Tengra" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Karfu fish" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Bata" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Kajari" ~ calories_grams*food_type_quant*170,
                                                 food_name=="Small prawn" ~ calories_grams*food_type_quant*3,
                                                 food_name=="Dried small shrimp/prawn" ~ calories_grams*food_type_quant*3,
# pulses (avg serving size and average size (nuts))
                                                 food_name=="Khesari" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Dried Lentil" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Shem bitchi" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Anchor daal" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Dried Chick pea" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Mung" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Black gram" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Dried Pea" ~ calories_grams*food_type_quant*160,
                                                 food_name=="Groundnut" ~ calories_grams*food_type_quant*1000,
                                                 food_name=="Brazilnut" ~ calories_grams*food_type_quant*1000,
                                                 food_name=="Cashew Nut" ~ calories_grams*food_type_quant*1000,
                                                 food_name=="Almond/Badam" ~ calories_grams*food_type_quant*1000,
                                                 food_name=="Hazelnut" ~ calories_grams*food_type_quant*1000,
                                                 food_name=="Chestnut" ~ calories_grams*food_type_quant*1000,
# fix vegetables (avg serving size per item)
                                                 food_name=="Patal" ~ calories_grams*food_type_quant*100,
                                                 food_name=="Okra" ~ calories_grams*food_type_quant*100,
                                                 food_name=="Eggplant" ~ calories_grams*food_type_quant*141,
                                                 food_name=="Bitter gourd" ~ calories_grams*food_type_quant*125,
                                                 food_name=="Radish" ~ calories_grams*food_type_quant*4.5,
                                                 food_name=="Pumpkin" ~ calories_grams*food_type_quant*5000,
                                                 food_name=="Green chili" ~ calories_grams*food_type_quant*45,
                                                 food_name=="Potato" ~ calories_grams*food_type_quant*200,
                                                 food_name=="Sweet potato" ~ calories_grams*food_type_quant*200,
                                                 food_name=="Sheem" ~ calories_grams*food_type_quant*100, # broad bean
                                                 food_name=="Onion" ~ calories_grams*food_type_quant*150,
                                                 food_name=="Tomato" ~ calories_grams*food_type_quant*40,
                                                 food_name=="Sweet gourd" ~ calories_grams*food_type_quant*500,
                                                 food_name=="Garlic" ~ calories_grams*food_type_quant*13,
                                                 food_name=="Water gourd" ~ calories_grams*food_type_quant*145,
                                                 food_name=="Drum stick" ~ calories_grams*food_type_quant*100, # 26 cal / moringa
                                                 food_name=="Carrot" ~ calories_grams*food_type_quant*70,
                                                 food_name=="Green banana" ~ calories_grams*food_type_quant*30,
                                                 food_name=="Cauliflower" ~ calories_grams*food_type_quant*550,
                                                 food_name=="Danta (amaranth)" ~ calories_grams*food_type_quant*45, # 170 cal
                                                 food_name=="Green Papaya"~ calories_grams*food_type_quant*680,
                                                 food_name=="Ash gourd" ~ calories_grams*food_type_quant*8000,
                                                 food_name=="Cucumber" ~ calories_grams*food_type_quant*25,
                                                 food_name=="Kachu (arum)" ~ calories_grams*food_type_quant*100, # 112 cal
                                                 food_name=="Green mango" ~ calories_grams*food_type_quant*150,
                                                 food_name=="Dhundal" ~ calories_grams*food_type_quant*100,
                                                 food_name=="Kachur lati" ~ calories_grams*food_type_quant*100,
                                                 food_name=="Green pea" ~ calories_grams*food_type_quant*18,
                                                 food_name=="Green jackfruit" ~ calories_grams*food_type_quant*7937,
                                                 food_name=="Mete alu" ~ calories_grams*food_type_quant*150,
                                                 food_name=="Kakrol" ~ calories_grams*food_type_quant*100, #spiny gourd
                                                 food_name=="Soybean bori" ~ calories_grams*food_type_quant*100,
                                                 food_name=="Beher gura" ~ calories_grams*food_type_quant*100, # couldnt find
                                                 food_name=="Shalgom" ~ calories_grams*food_type_quant*4.5, # turnip, couldnt find
# fish large (avg large fish calorie count 1000)
                                                food_name=="Rui" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Telapia" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Swarputi" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Singi" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Grass Carp" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Taki" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Pangash" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Silver Carp" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Mrigel" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Kalibaus" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Hilsa" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Katla" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Jatka" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Aair" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Boal" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Dried fish" ~ calories_grams*food_type_quant*1000,
                                                food_name=="Mirror Carp" ~ calories_grams*food_type_quant*1000,
# spices (avg calorie count 5)
                                                food_name=="Dried chili" ~ calories_grams*food_type_quant*5,
                                                food_name=="Elachi" ~ calories_grams*food_type_quant*5,
                                                food_name=="Cinnamon" ~ calories_grams*food_type_quant*5,
                                                food_name=="Fresh Ginger" ~ calories_grams*food_type_quant*5,
# other food (average serving size)
                                                food_name=="Pitha" ~ calories_grams*food_type_quant*100,
                                                food_name=="Ruti/Parota" ~ calories_grams*food_type_quant*100,
                                                food_name=="Singara" ~ calories_grams*food_type_quant*100,
                                                food_name=="Rice/Jao" ~ calories_grams*food_type_quant*100,
                                                food_name=="Piaju" ~ calories_grams*food_type_quant*100,
                                                food_name=="Cake" ~ calories_grams*food_type_quant*100,
                                                food_name=="Nimki" ~ calories_grams*food_type_quant*100,
                                                food_name=="Puri" ~ calories_grams*food_type_quant*100,
                                                food_name=="Alur chap" ~ calories_grams*food_type_quant*100,
                                                food_name=="Biscuit" ~ calories_grams*food_type_quant*100,
                                                food_name=="Bonroti/paoroti" ~ calories_grams*food_type_quant*100,
                                                food_name=="Khichuri" ~ calories_grams*food_type_quant*100,
                                                food_name=="Polao/Biryani/Tehari" ~ calories_grams*food_type_quant*100,
                                                food_name=="Chips" ~ calories_grams*food_type_quant*100,
                                                food_name=="Patties" ~ calories_grams*food_type_quant*100,
                                                food_name=="Chewing gum" ~ calories_grams*food_type_quant*100,                                               
# vegetables (average serving size of 1 cup/128 grams)
                                                food_name=="Lal Shak (red amaranth)" ~ calories_grams*food_type_quant*128,
                                                food_name=="Bathua" ~ calories_grams*food_type_quant*128,
                                                food_name=="Pat Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Dheki Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Pui (Indian spinach)" ~ calories_grams*food_type_quant*128,
                                                food_name=="Dhania Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Lau Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Onion/garlic stalk" ~ calories_grams*food_type_quant*128,
                                                food_name=="Kalmi Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Radish leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Kachu Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Kalo kachu Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Cabbage" ~ calories_grams*food_type_quant*128,
                                                food_name=="Helencha" ~ calories_grams*food_type_quant*128,
                                                food_name=="Katanate" ~ calories_grams*food_type_quant*128,
                                                food_name=="Palang Shak (spinach)" ~ calories_grams*food_type_quant*128,
                                                food_name=="Pea leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Drumstick leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Mustard leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Mixed leafy vegetables" ~ calories_grams*food_type_quant*128,
                                                food_name=="Dudhali Pata" ~ calories_grams*food_type_quant*128,
                                                food_name=="Khesari Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Swett gourd leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Black gram leaves" ~ calories_grams*food_type_quant*128,
                                                food_name=="Geema Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Neem Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Darkuni Shak" ~ calories_grams*food_type_quant*128,
                                                food_name=="Bokful" ~ calories_grams*food_type_quant*128,
                                                food_name=="Litchis" ~ calories_grams*food_type_quant*128,
# oil (serving size 15m)  
                                                food_name=="Soybean" ~ calories_grams*food_type_quant*15,
                                                food_name=="Mustard" ~ calories_grams*food_type_quant*15,
                                                food_name=="Dalda/banspati" ~ calories_grams*food_type_quant*15,
                                                food_name=="Red Palm Oil" ~ calories_grams*food_type_quant*15,
                                                food_name=="Ghee" ~ calories_grams*food_type_quant*15,
                                                food_name=="Sesame oil" ~ calories_grams*food_type_quant*15, 
                                                food_name=="Yellow Palm Oil" ~ calories_grams*food_type_quant*15,
# fruit(avg serving size) 
                                                food_name=="Apple" ~ calories_grams*food_type_quant*100,
                                                food_name=="Mango" ~ calories_grams*food_type_quant*100,
                                                food_name=="Guava" ~ calories_grams*food_type_quant*100,
                                                food_name=="Banana" ~ calories_grams*food_type_quant*100,
                                                food_name=="Lemon" ~ calories_grams*food_type_quant*100,
                                                food_name=="Karambola" ~ calories_grams*food_type_quant*100,
                                                food_name=="Grapes" ~ calories_grams*food_type_quant*100,
                                                food_name=="Dates" ~ calories_grams*food_type_quant*100,
                                                food_name=="Jujube/dried jujube" ~ calories_grams*food_type_quant*100,
                                                food_name=="Coconut" ~ calories_grams*food_type_quant*100,
                                                food_name=="Orange" ~ calories_grams*food_type_quant*100,
                                                food_name=="Bel" ~ calories_grams*food_type_quant*100,
                                                food_name=="Tamarind" ~ calories_grams*food_type_quant*100,
                                                food_name=="Olive" ~ calories_grams*food_type_quant*100,
                                                food_name=="Chalta" ~ calories_grams*food_type_quant*100,
                                                food_name=="Pomelo" ~ calories_grams*food_type_quant*100,
                                                food_name=="Jack Fruit" ~ calories_grams*food_type_quant*100,
                                                food_name=="Pomelo" ~ calories_grams*food_type_quant*100,
                                                food_name=="Amra" ~ calories_grams*food_type_quant*100,
                                                food_name=="Papaya" ~ calories_grams*food_type_quant*100,
                                                food_name=="Black berry" ~ calories_grams*food_type_quant*100,
                                                food_name=="Green Coconut" ~ calories_grams*food_type_quant*100,
                                                food_name=="Dalim" ~ calories_grams*food_type_quant*100,
                                                food_name=="Tarmuj (Water melon)" ~ calories_grams*food_type_quant*100,
                                                food_name=="Ata (bullock's heart)" ~ calories_grams*food_type_quant*100,
                                                food_name=="Bangi (Musk melon)" ~ calories_grams*food_type_quant*100,
                                                food_name=="Pine apple" ~ calories_grams*food_type_quant*100,
                                                food_name=="Sobeda" ~ calories_grams*food_type_quant*100,
                                                food_name=="Jaamrul" ~ calories_grams*food_type_quant*100))

```


## Plots
```{r}
fooddiary_nocounts <- fooddiary_cleaned %>% filter(food_type_unit != 8) %>% filter(recall=="week")

p1 <- ggplot(fooddiary_nocounts, aes(x=submission_month, y=calories_total_grams)) +
  geom_line(color="#69b3a2", size=2) +
  ggtitle("Calories reported by month")

p2 <- ggplot(fooddiary_nocounts, aes(x=week_number, y=calories_total_grams)) +
  geom_line(color="#69b3a2", size=2) +
  ggtitle("Calories reported by week")

p3 <- ggplot(fooddiary_nocounts, aes(x=time_of_day, y=calories_total_grams)) +
  geom_line(color="#69b3a2", size=2) +
  ggtitle("Calories reported by time of day")

p4 <- ggplot(fooddiary_nocounts, aes(x=submission_weekday, y=calories_total_grams)) +
  geom_line(color="#69b3a2", size=2) +
  ggtitle("Calories reported by day of the week")

p1
p2
p3
p4
```
```{r fig1, fig.height = 3.5, fig.width = 3.5}
p1 <- fooddiary_nocounts %>%
  filter(recall=="week") %>%
  ggplot(aes(food_name_type)) +
      geom_bar(fill = "darkorchid4") +
      facet_wrap( ~ submission_month, ncol = 4) +
      labs(title = "Food Types Reported by Week",
           subtitle = " ",
           y = "count",
           x = "food group") + theme_bw(base_size = 15)
p1 + theme(axis.text.x = element_text(angle = 60, hjust = 1))
```

Look for Ramadan and Manga
```{r fig2, fig.height = 3.5, fig.width = 3.5}
# fooddiary_cleaned <- fooddiary_cleaned %>% mutate(calories_total_kg = calories_total_grams/1000)

fooddiary_cleaned_week <- fooddiary_nocounts 
xyplot(
  calories_total_grams ~ submission_month | food_name_type, 
  # layout = c(2, 7),               # panel with ncol = 5 and nrow = 3
  group = food_name_type, data = fooddiary_cleaned_week,
  type = c("p", "smooth"),        # Show points and smoothed line
  scales = "free"                 # Make panels axis scales independent
  )
```

# Notes
Responses in food diary:
Look over time and identify periods were there were responses
Seasonal access to calories
Mean and variance as access to calories and cluster households
Relatively low caloric variation/or feast vs famine
