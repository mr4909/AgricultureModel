---
title: "Crowdsourcing"
author: "Mari Roberts"
date: "5/12/2020"
output: html_document
---

"Many tasks included a 'crowdsourcing' component, in which the respondent would complete the task first for him- or herself, and then repeat the task for any friend, neighbor, or passerby; these participants were ideally selected on an approximately random basis ... The purpose of the crowdsourcing component in the study was to examine whether a crowdsourced sample might demonstrate a reduced selection bias, and thus better approximate a true representative sample, than our purposive sample of potential early adopters."

The purpose of this code is to test this out by examining how similar the purposive sample is to the crowdsourced one in terms of select characteristics (e.g., age, gender, literacy, education, etc.) and even in terms of responses to a select number of questions.  If the personal characteristics are highly similar between the two samples, it may be that as suggested by Professor Andrew Bell, selection bias is not reduced by crowdsourcing in this way and that, therefore, this particular type of crowdsourced sample does not yield a better approximation of a true representative sample as intended. I also look at the distributions of the two samples in terms of these demographics, etc. and see which one better reflects the population to see which one is more representative.  

I hypothesize that individuals selected by respondents because they are friends, neighbors, or passersby, would tend to be similar in traits to the respondents and not provide the protection against selection bias that is proposed. 

Bad Shocks, - no crowdsourcing info?
Good Shocks, - no crowdsourcing info?

```{r}
respondent <- HouseholdComposition_members_level_2.dta %>%filter(hhm_relation == 1) %>% 
  select(hh_ID, hhm_sex, hhm_age, education)
respondent <- respondent %>% filter(education!=77 & education!=99)
```

# Illness
```{r}
illness_cs_test <- `85. illness_level_1.dta` %>% filter(recall == "week")

######
# crowdourced info
######
illness_cs <- illness_cs_test %>% filter(crowdsource == 1) %>% select(hh_ID, submissiondate, recall, week_number, 
                                  illness_status)

# find satisfaction average
illness_cs <- illness_cs %>% 
  group_by(hh_ID) %>%
  summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
illness_cs <- transform(illness_cs, illness_cs = rowMeans(illness_cs[,-1], na.rm = TRUE))
illness_cs <- illness_cs %>% select(hh_ID, illness_cs)

######
# respondent info
######
illness_r <- illness_cs_test %>% filter(crowdsource == 0) %>% select(hh_ID, submissiondate, recall, week_number, 
                                  illness_status)

# find satisfaction average
illness_r <- illness_r %>% 
  group_by(hh_ID) %>%
  summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
illness_r <- transform(illness_r, illness_r = rowMeans(illness_r[,-1], na.rm = TRUE))
illness_r <- illness_r %>% select(hh_ID, illness_r)

######
# merge
######

illness_avg <- merge(illness_r, illness_cs, by = "hh_ID")

# Overlaid histograms
illness_avg <- melt(illness_avg, id=(c("hh_ID")))
illness_avg <- illness_avg %>% mutate(variable = ifelse(variable == "illness_r", "Respondent", "Crowdsource"))
ggplot(illness_avg, aes(x=value, color=variable)) +
  geom_histogram(fill="white", alpha=0.5, position="identity")

# mean
mu <- plyr::ddply(illness_avg, "variable", summarise, grp.mean=mean(value))
p<-ggplot(illness_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Does Anyone in the Houshold Experience Illness or Injury?",x="Illness Rate", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))
```

```{r}
######
# merge
######
illness_cs <- `85. illness_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
illness_cs <- illness_cs %>% distinct()
illness_cs <- illness_cs %>% filter(sex_cs=="1" | sex_cs =="2")
illness_cs <- illness_cs %>% filter(age_cs >= 0 & age_cs <= 110)
illness_cs <- illness_cs %>% filter(education_cs!=77 & education_cs!=99)


######
# average age
######

illness_age_avg <- merge(illness_cs, respondent, by = "hh_ID")
illness_age_avg <- illness_age_avg %>% select(hh_ID, age_cs, hhm_age)
illness_age_avg <- melt(illness_age_avg, id=(c("hh_ID")))
# illness_age_avg <- illness_age_avg %>% mutate(variable = ifelse(variable == "illness_r", "Respondent", "Crowdsource"))
# Overlaid histograms

mu_illness <- plyr::ddply(illness_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(illness_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Does Anyone in the Houshold Experience Illness or Injury?",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

######
# sex chosen
######
illness_sex_avg <- merge(illness_cs, respondent, by = "hh_ID")
illness_sex_avg <- illness_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
illness_sex_avg <- illness_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- illness_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- illness_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

# illness_sex_avg <- melt(illness_sex_avg, id=(c("hh_ID")))
View(temp1)
mu_sex_illness <- mean(temp1$sex_rate)
mu_sex_illness

######
# age chosen
######
illness_age_avg <- merge(illness_cs, respondent, by = "hh_ID")
illness_age_avg <- illness_age_avg %>% select(hh_ID, hhm_age, age_cs)
illness_age_avg <- illness_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                        hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                        hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                        hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                        hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                        hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                        hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                        hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                        hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
illness_age_avg <- illness_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                       age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                       age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                       age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                       age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                       age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                       age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                       age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                       age_cs >= 90 & age_cs < 100 ~ "ninties"))

illness_age_avg <- illness_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- illness_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- illness_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_illness <- mean(temp1$age_rate)
mu_age_illness

######
# education chosen
######
illness_education_avg <- merge(illness_cs, respondent, by = "hh_ID")
illness_education_avg <- illness_education_avg %>% select(hh_ID, education, education_cs)
illness_education_avg <- illness_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- illness_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- illness_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# illness_education_avg <- melt(illness_education_avg, id=(c("hh_ID")))
View(temp1)
mu_education_illness <- mean(temp1$education_rate)
mu_education_illness
```

# Wellbeing
```{r}
######
# merge
######
wellbeing_cs <- `69. SubjectiveWellbeing.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
wellbeing_cs <- wellbeing_cs %>% distinct()
wellbeing_cs <- wellbeing_cs %>% filter(sex_cs=="1" | sex_cs =="2")
wellbeing_cs <- wellbeing_cs %>% filter(age_cs >= 0 & age_cs <= 110)
wellbeing_cs <- wellbeing_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age
######

wellbeing_age_avg <- merge(wellbeing_cs, respondent, by = "hh_ID")
wellbeing_age_avg <- wellbeing_age_avg %>% select(hh_ID, age_cs, hhm_age)
wellbeing_age_avg <- melt(wellbeing_age_avg, id=(c("hh_ID")))

# Overlaid histograms

mu_wellbeing <- plyr::ddply(wellbeing_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(wellbeing_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Wellbeing",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
                                  linetype="dashed"))

#########
# sex chosen
#########
wellbeing_sex_avg <- merge(wellbeing_cs, respondent, by = "hh_ID")
wellbeing_sex_avg <- wellbeing_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
wellbeing_sex_avg <- wellbeing_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- wellbeing_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- wellbeing_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_wellbeing <- mean(temp1$sex_rate)
mu_sex_wellbeing

wellbeing_age_avg <- merge(wellbeing_cs, respondent, by = "hh_ID")
wellbeing_age_avg <- wellbeing_age_avg %>% select(hh_ID, hhm_age, age_cs)
wellbeing_age_avg <- wellbeing_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                            hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                            hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                            hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                            hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                            hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                            hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                            hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                            hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
wellbeing_age_avg <- wellbeing_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                           age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                           age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                           age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                           age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                           age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                           age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                           age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                           age_cs >= 90 & age_cs < 100 ~ "ninties"))

wellbeing_age_avg <- wellbeing_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- wellbeing_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- wellbeing_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_wellbeing <- mean(temp1$age_rate)
mu_age_wellbeing

wellbeing_education_avg <- merge(wellbeing_cs, respondent, by = "hh_ID")
wellbeing_education_avg <- wellbeing_education_avg %>% select(hh_ID, education, education_cs)
wellbeing_education_avg <- wellbeing_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- wellbeing_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- wellbeing_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# wellbeing_education_avg <- melt(wellbeing_education_avg, id=(c("hh_ID")))
mu_education_wellbeing <- mean(temp1$education_rate)
mu_education_wellbeing
```

```{r}

# wellbeing_cs_test <- `69. SubjectiveWellbeing.dta` %>% filter(recall == "week")
# 
# ######
# # crowdourced info
# ######
# satisfaction_cs <- wellbeing_cs_test %>% filter(crowdsource == 1) %>% select(hh_ID, submissiondate, recall, week_number, 
#                                   g1_satisfied, g2_satisfied, g3_satisfied, 
#                                   g4_satisfied, g5_satisfied)
# 
# satisfaction_cs <- satisfaction_cs[!duplicated(satisfaction_cs$hh_ID), ]
# 
# 
# # find satisfaction average
# satisfaction_cs <- satisfaction_cs %>% 
#   group_by(hh_ID) %>%
#   summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
# satisfaction_cs <- transform(satisfaction_cs, satisfaction_cs = rowMeans(satisfaction_cs[,-1], na.rm = TRUE))
# satisfaction_cs <- satisfaction_cs %>% select(hh_ID, satisfaction_cs)
# 
# ######
# # respondent info
# ######
# satisfaction_r <- wellbeing_cs_test %>% filter(crowdsource == 0) %>% select(hh_ID, submissiondate, recall, week_number, 
#                                   g1_satisfied, g2_satisfied, g3_satisfied, 
#                                   g4_satisfied, g5_satisfied)
# 
# satisfaction_r <- satisfaction_r[!duplicated(satisfaction_r$hh_ID), ]
# 
# # find satisfaction average
# satisfaction_r <- satisfaction_r %>% 
#   group_by(hh_ID) %>%
#   summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
# satisfaction_r <- transform(satisfaction_r, satisfaction_r = rowMeans(satisfaction_r[,-1], na.rm = TRUE))
# satisfaction_r <- satisfaction_r %>% select(hh_ID, satisfaction_r)
# 
# ######
# # merge
# ######
# 
# satisfaction_all <- merge(satisfaction_r, satisfaction_cs, by = "hh_ID")
# 
# wellbeing_cs <- `69. SubjectiveWellbeing.dta`  %>% 
#   filter(crowdsource == 1 & recall == "week") %>% 
#   select( hh_ID,
#           week_number,
#           crowdsource,
#           sex_cs = gender,
#           age_cs = age,
#           education_cs = education,
#           highest_class_cs = highest_class,
#           relationship) 
# 
# wellbeing_cs <- wellbeing_cs[!duplicated(wellbeing_cs$hh_ID), ]

```

# School attendance
```{r}

######
# merge
######
school_cs <- `94. schoolAttendance_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
school_cs <- school_cs %>% distinct()
school_cs <- school_cs %>% filter(sex_cs=="1" | sex_cs =="2")
school_cs <- school_cs %>% filter(age_cs >= 0 & age_cs <= 110)
school_cs <- school_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age
######
school_age_avg <- merge(school_cs, respondent, by = "hh_ID")
school_age_avg <- school_age_avg %>% select(hh_ID, age_cs, hhm_age)
school_age_avg <- melt(school_age_avg, id=(c("hh_ID")))

# Overlaid histograms

mu_school <- plyr::ddply(school_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(school_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: School Attendance",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

######
# sex chosen
######
school_sex_avg <- merge(school_cs, respondent, by = "hh_ID")
school_sex_avg <- school_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
school_sex_avg <- school_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- school_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- school_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_school <- mean(temp1$sex_rate)
mu_sex_school

#########
# sex chosen
#########
school_sex_avg <- merge(school_cs, respondent, by = "hh_ID")
school_sex_avg <- school_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
school_sex_avg <- school_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- school_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- school_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_school <- mean(temp1$sex_rate)
mu_sex_school

school_age_avg <- merge(school_cs, respondent, by = "hh_ID")
school_age_avg <- school_age_avg %>% select(hh_ID, hhm_age, age_cs)
school_age_avg <- school_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                            hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                            hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                            hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                            hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                            hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                            hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                            hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                            hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
school_age_avg <- school_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                           age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                           age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                           age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                           age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                           age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                           age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                           age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                           age_cs >= 90 & age_cs < 100 ~ "ninties"))

school_age_avg <- school_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- school_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- school_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_school <- mean(temp1$age_rate)
mu_age_school

school_education_avg <- merge(school_cs, respondent, by = "hh_ID")
school_education_avg <- school_education_avg %>% select(hh_ID, education, education_cs)
school_education_avg <- school_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- school_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- school_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# school_education_avg <- melt(school_education_avg, id=(c("hh_ID")))
mu_education_school <- mean(temp1$education_rate)
mu_education_school
```

# Food Diary
```{r}
######
# merge
######
fooddiary_cs <- `33. FoodDiary_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
fooddiary_cs <- fooddiary_cs %>% distinct()
fooddiary_cs <- fooddiary_cs %>% filter(sex_cs=="1" | sex_cs =="2")
fooddiary_cs <- fooddiary_cs %>% filter(age_cs >= 0 & age_cs <= 110)
fooddiary_cs <- fooddiary_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age, sex, education, etc of crowdsourcee
######

fooddiary_age_avg <- merge(fooddiary_cs, respondent, by = "hh_ID")
fooddiary_age_avg <- fooddiary_age_avg %>% select(hh_ID, age_cs, hhm_age)
fooddiary_age_avg <- melt(fooddiary_age_avg, id=(c("hh_ID")))

# Overlaid histograms

mu_fooddiary <- plyr::ddply(fooddiary_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(fooddiary_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Food Diary",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

#######
# sex chosen
#######
food_sex_avg <- merge(fooddiary_cs, respondent, by = "hh_ID")
food_sex_avg <- food_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
food_sex_avg <- food_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- food_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- food_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_food <- mean(temp1$sex_rate)
mu_sex_food

#########
# sex chosen
#########
fooddiary_sex_avg <- merge(fooddiary_cs, respondent, by = "hh_ID")
fooddiary_sex_avg <- fooddiary_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
fooddiary_sex_avg <- fooddiary_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- fooddiary_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- fooddiary_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_fooddiary <- mean(temp1$sex_rate)
mu_sex_fooddiary

fooddiary_age_avg <- merge(fooddiary_cs, respondent, by = "hh_ID")
fooddiary_age_avg <- fooddiary_age_avg %>% select(hh_ID, hhm_age, age_cs)
fooddiary_age_avg <- fooddiary_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                            hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                            hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                            hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                            hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                            hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                            hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                            hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                            hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
fooddiary_age_avg <- fooddiary_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                           age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                           age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                           age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                           age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                           age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                           age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                           age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                           age_cs >= 90 & age_cs < 100 ~ "ninties"))

fooddiary_age_avg <- fooddiary_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- fooddiary_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- fooddiary_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_fooddiary <- mean(temp1$age_rate)
mu_age_fooddiary

fooddiary_education_avg <- merge(fooddiary_cs, respondent, by = "hh_ID")
fooddiary_education_avg <- fooddiary_education_avg %>% select(hh_ID, education, education_cs)
fooddiary_education_avg <- fooddiary_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- fooddiary_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- fooddiary_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# fooddiary_education_avg <- melt(fooddiary_education_avg, id=(c("hh_ID")))
mu_education_fooddiary <- mean(temp1$education_rate)
mu_education_fooddiary
```

# Employment
```{r}
######
# merge
######
employment_cs <- `80. employment_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
employment_cs <- employment_cs %>% distinct()
employment_cs <- employment_cs %>% filter(sex_cs=="1" | sex_cs =="2")
employment_cs <- employment_cs %>% filter(age_cs >= 0 & age_cs <= 110)
employment_cs <- employment_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age, sex, education, etc of crowdsourcee
######

employment_age_avg <- merge(employment_cs, respondent, by = "hh_ID")
employment_age_avg <- employment_age_avg %>% select(hh_ID, age_cs, hhm_age)
employment_age_avg <- melt(employment_age_avg, id=(c("hh_ID")))

# Overlaid histograms

mu_employment <- plyr::ddply(employment_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(employment_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Employment",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

######
# sex chosen
######
employment_sex_avg <- merge(employment_cs, respondent, by = "hh_ID")
employment_sex_avg <- employment_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
employment_sex_avg <- employment_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- employment_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- employment_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_employment <- mean(temp1$sex_rate)
mu_sex_employment

#########
# sex chosen
#########
employment_sex_avg <- merge(employment_cs, respondent, by = "hh_ID")
employment_sex_avg <- employment_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
employment_sex_avg <- employment_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- employment_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- employment_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_employment <- mean(temp1$sex_rate)
mu_sex_employment

employment_age_avg <- merge(employment_cs, respondent, by = "hh_ID")
employment_age_avg <- employment_age_avg %>% select(hh_ID, hhm_age, age_cs)
employment_age_avg <- employment_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                            hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                            hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                            hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                            hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                            hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                            hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                            hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                            hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
employment_age_avg <- employment_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                           age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                           age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                           age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                           age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                           age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                           age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                           age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                           age_cs >= 90 & age_cs < 100 ~ "ninties"))

employment_age_avg <- employment_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- employment_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- employment_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_employment <- mean(temp1$age_rate)
mu_age_employment

employment_education_avg <- merge(employment_cs, respondent, by = "hh_ID")
employment_education_avg <- employment_education_avg %>% select(hh_ID, education, education_cs)
employment_education_avg <- employment_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- employment_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- employment_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# employment_education_avg <- melt(employment_education_avg, id=(c("hh_ID")))
mu_education_employment <- mean(temp1$education_rate)
mu_education_employment
```

# Transportation Tools
```{r}
######
# merge
######
transportation_cs <- `72. TransportationTools_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "month") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
transportation_cs <- transportation_cs %>% distinct()
transportation_cs <- transportation_cs %>% filter(sex_cs=="1" | sex_cs =="2")
transportation_cs <- transportation_cs %>% filter(age_cs >= 0 & age_cs <= 110)
transportation_cs <- transportation_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age, sex, education, etc of crowdsourcee
######

transportation_age_avg <- merge(transportation_cs, respondent, by = "hh_ID")
transportation_age_avg <- transportation_age_avg %>% select(hh_ID, age_cs, hhm_age)
transportation_age_avg <- melt(transportation_age_avg, id=(c("hh_ID")))
# Overlaid histograms

mu_transportation <- plyr::ddply(transportation_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(transportation_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Transportation Tools",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

#########
# sex chosen
#########
transportation_sex_avg <- merge(transportation_cs, respondent, by = "hh_ID")
transportation_sex_avg <- transportation_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
transportation_sex_avg <- transportation_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- transportation_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- transportation_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_transportation <- mean(temp1$sex_rate)
mu_sex_transportation

#########
# age chosen
#########

transportation_age_avg <- merge(transportation_cs, respondent, by = "hh_ID")
transportation_age_avg <- transportation_age_avg %>% select(hh_ID, hhm_age, age_cs)
transportation_age_avg <- transportation_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                            hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                            hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                            hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                            hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                            hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                            hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                            hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                            hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
transportation_age_avg <- transportation_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                           age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                           age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                           age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                           age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                           age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                           age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                           age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                           age_cs >= 90 & age_cs < 100 ~ "ninties"))

transportation_age_avg <- transportation_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- transportation_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- transportation_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_transportation <- mean(temp1$age_rate)
mu_age_transportation

transportation_education_avg <- merge(transportation_cs, respondent, by = "hh_ID")
transportation_education_avg <- transportation_education_avg %>% select(hh_ID, education, education_cs)
transportation_education_avg <- transportation_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- transportation_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- transportation_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# transportation_education_avg <- melt(transportation_education_avg, id=(c("hh_ID")))
mu_education_transportation <- mean(temp1$education_rate)
mu_education_transportation
```

# Drinking water Diary
```{r}
######
# merge
######
water_cs <- `72. TransportationTools_level_1.dta`  %>% 
  filter(crowdsource == 1 & recall == "month") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship)
water_cs <- water_cs %>% distinct()
water_cs <- water_cs %>% filter(sex_cs=="1" | sex_cs =="2")
water_cs <- water_cs %>% filter(age_cs >= 0 & age_cs <= 110)
water_cs <- water_cs %>% filter(education_cs!=77 & education_cs!=99)

######
# average age, sex, education, etc of crowdsourcee
######

# age
water_age_avg <- merge(water_cs, respondent, by = "hh_ID")
water_age_avg <- water_age_avg %>% select(hh_ID, age_cs, hhm_age)
water_age_avg <- melt(water_age_avg, id=(c("hh_ID")))
# Overlaid histograms

mu_water <- plyr::ddply(water_age_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(water_age_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Age: Water",x="Age", y = "Count")+ theme(legend.title = element_blank())
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

# choose age
water_age_avg <- merge(water_cs, respondent, by = "hh_ID")
water_age_avg <- water_age_avg %>% select(hh_ID, hhm_age, age_cs)
water_age_avg <- water_age_avg %>% mutate(hhm_age_group = case_when(hhm_age <= 18 ~ "child",
                                                                hhm_age >  18 & hhm_age < 30 ~ "twenties",
                                                                hhm_age >= 30 & hhm_age < 40 ~ "thirties",
                                                                hhm_age >= 40 & hhm_age < 50 ~ "forties",
                                                                hhm_age >= 50 & hhm_age < 60 ~ "fifties",
                                                                hhm_age >= 60 & hhm_age < 70 ~ "sixties",
                                                                hhm_age >= 70 & hhm_age < 80 ~ "seventies",
                                                                hhm_age >= 80 & hhm_age < 90 ~ "eighties",
                                                                hhm_age >= 90 & hhm_age < 100 ~ "ninties"))
water_age_avg <- water_age_avg %>% mutate(cs_age_group = case_when(age_cs <= 18 ~ "child",
                                                                age_cs >  18 & age_cs < 30 ~ "twenties",
                                                                age_cs >= 30 & age_cs < 40 ~ "thirties",
                                                                age_cs >= 40 & age_cs < 50 ~ "forties",
                                                                age_cs >= 50 & age_cs < 60 ~ "fifties",
                                                                age_cs >= 60 & age_cs < 70 ~ "sixties",
                                                                age_cs >= 70 & age_cs < 80 ~ "seventies",
                                                                age_cs >= 80 & age_cs < 90 ~ "eighties",
                                                                age_cs >= 90 & age_cs < 100 ~ "ninties"))

water_age_avg <- water_age_avg %>% mutate(age_rate = ifelse(hhm_age_group==cs_age_group,1,0))

temp <- water_age_avg %>% group_by(hh_ID) %>% tally(age_rate)
temp_entries <- water_age_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(age_rate = entries/total) %>% select(-total,-entries)

mu_age_water <- mean(temp1$age_rate)
mu_age_water

# sex
water_sex_avg <- merge(water_cs, respondent, by = "hh_ID")
water_sex_avg <- water_sex_avg %>% select(hh_ID, hhm_sex, sex_cs)
water_sex_avg <- water_sex_avg %>% mutate(sex_rate = ifelse(hhm_sex==sex_cs,1,0))

temp <- water_sex_avg %>% group_by(hh_ID) %>% tally(sex_rate)
temp_entries <- water_sex_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(sex_rate = entries/total) %>% select(-total,-entries)

mu_sex_water <- mean(temp1$sex_rate)
mu_sex_water

water_education_avg <- merge(water_cs, respondent, by = "hh_ID")
water_education_avg <- water_education_avg %>% select(hh_ID, education, education_cs)
water_education_avg <- water_education_avg %>% mutate(education_rate = ifelse(education==education_cs,1,0))

temp <- water_education_avg %>% group_by(hh_ID) %>% tally(education_rate)
temp_entries <- water_education_avg %>% count(hh_ID)
temp1 <- merge(temp_entries, temp, by = "hh_ID")
temp1 <- temp1 %>% mutate(total = n.x, entries = n.y) %>% select(-n.x,-n.y)
temp1 <- temp1 %>% mutate(education_rate = entries/total) %>% select(-total,-entries)

# water_education_avg <- melt(water_education_avg, id=(c("hh_ID")))
mu_education_water <- mean(temp1$education_rate)
mu_education_water


########
# education plot
########
# age
water_education_avg <- merge(water_cs, respondent, by = "hh_ID")
water_education_avg <- water_education_avg %>% select(hh_ID, education, education_cs)
water_education_avg <- melt(water_education_avg, id=(c("hh_ID")))
# Overlaid histograms

mu_water <- plyr::ddply(water_education_avg, "variable", summarise, grp.mean=mean(value))

p<-ggplot(water_education_avg, aes(x=value, fill=variable, color=variable)) +
  geom_histogram(position="identity", alpha=0.5)+ labs(title="Education: Water",x="Education Level", y = "Count")+ theme(legend.title = element_blank())+
  xlim(0, 8)
p+geom_vline(data=mu_illness, aes(xintercept=grp.mean, color=variable,
             linetype="dashed"))

```

# TOTAL AVERAGES
```{r}
sex_avg = (mu_sex_employment + mu_sex_food + mu_sex_illness + mu_sex_school + mu_sex_transportation + mu_sex_water + mu_sex_wellness)/7
sex_avg

age_avg = (mu_age_employment + mu_age_fooddiary + mu_age_illness + mu_age_school + mu_age_transportation + mu_age_water + mu_age_wellbeing)/7
age_avg

education_avg = (mu_education_employment + mu_education_fooddiary + mu_education_illness + mu_education_school + mu_education_transportation + mu_education_water + mu_education_wellbeing)/7
education_avg
```

# Good Shocks
```{r}
goodshocks_cs_test <- `39. GoodShocks_level_1.dta` %>% filter(recall == "season")
# goodshocks_cs_test <- merge(goodshocks_cs_test, `40. GoodShocks_event_repeat_level_2.dta`, by == c("hh_ID","gshock_1_ID"))

######
# crowdourced info
######
gs_cs <- goodshocks_cs_test %>% filter(crowdsource == 1) %>% select(hh_ID, submissiondate, recall, week_number, 
                                  yesno)
# find satisfaction average
gs_cs <- gs_cs %>% 
  group_by(hh_ID) %>%
  summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
gs_cs <- transform(gs_cs, gs_cs = rowMeans(gs_cs[,-1], na.rm = TRUE))
gs_cs <- gs_cs %>% select(hh_ID, gs_cs)

######
# respondent info
######
gs_r <- goodshocks_cs_test %>% filter(crowdsource == 0) %>% select(hh_ID, submissiondate, recall, week_number, 
                                  yesno)
# find satisfaction average
gs_r <- gs_r %>% 
  group_by(hh_ID) %>%
  summarise_at(vars(-submissiondate, -recall, -week_number), funs(mean(., na.rm=TRUE)))
gs_r <- transform(gs_r, gs_r = rowMeans(gs_r[,-1], na.rm = TRUE))
gs_r <- gs_r %>% select(hh_ID, gs_r)

######
# merge
######

satisfaction_all <- merge(gs_r, gs_cs, by = "hh_ID")

wellbeing_cs <- `69. SubjectiveWellbeing.dta`  %>% 
  filter(crowdsource == 1 & recall == "week") %>% 
  select( hh_ID,
          week_number,
          crowdsource,
          sex_cs = gender,
          age_cs = age,
          education_cs = education,
          highest_class_cs = highest_class,
          relationship) 
```



